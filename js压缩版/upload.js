var common={"config":{"port":"80","userdata":(function(){return +(Math.round(Math.random()*10000).toString()+new Date().getMilliseconds())})()},"cookie":{"get":function(A){var B=document.cookie.match(new RegExp("\\b"+A+"\\b=([^=;s]*)?","g"));return B&&B[1]}},"genFileId":function(){return +(Math.round(Math.random()*10000).toString()+new Date().getMilliseconds())},"initPlugin":function(){var A=function(){var C;if(_isSupportActiveX()){try{new ActiveXObject("TXFTNActiveX.FTNUpload")}catch(B){return false}}else{C=navigator.plugins["Tencent FTN plug-in"];if(!C||_isFF()&&(C[0].type!="application/txftn"&&C[0].type!="application/txftn-webkit")||!_isFF()&&C[0].type!="application/txftn-webkit"){return false}_pluginType=C[0].type}return true};if(_plugin){return 0}if(!A()){return 1}if(_isSupportActiveX()){_plugin=new ActiveXObject("TXFTNActiveX.FTNUpload")}else{_plugin=document.createElement("embed");_plugin.width=0;_plugin.height=0;_plugin.type=_pluginType;_plugin=document.body.appendChild(_plugin)}_plugin.OnEvent=common.OnEventHandler;_plugin.RetryTime=20;_plugin.BlockSize=128*1024;_plugin.TimeOut=90*1000;_plugin.BreakSize=64*1024;_plugin.MaxConcurrentUploadNum=3;return 0},"OnEventHandler":function(B){if(_plugin.UserDatabyLocalID(B.LocalID)==9226){return}var A=[function(){},function(){var C=document.getElementById("tempscript");common.config.Path=B.Path;common.config.FileSize=B.FileSize;common.config.Processed=B.Processed;common.config.userdata=_plugin.UserDatabyLocalID(B.LocalID);common.config.sha=B.SHA;common.config.md5=B.Md5;common.config.fileSize=B.FileSize;if(B.FileSize>104857600){common.setMsg("文件大小请控制在100M以内",2);return false}if(!C){C=document.createElement("script");C.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(C)}C.src="http://open.t.qq.com/api/file/upload_file?filesize="+B.FileSize+"&shahash="+B.SHA+"&md5="+B.Md5+"&filename="+B.Path+"&createtime=1363868150&modifytime=1363868150&format=common.uploadFile&t="+(+new Date());common.setMsg("成功获取签名信息，开始创建文件...",0)},function(){common.setMsg("正在获取文件签名信息...",0);common.setUploadProgress(B.Processed/B.FileSize)},function(){if(B.ErrorCode!==0||B.Step!==0){common.setMsg("上传失败",2);frameElement.callback({"ret":1,"path":""})}else{common.setMsg('上传成功,<a href="http://app.t.qq.com/download.php?key='+(common.config.filekey.slice(1))+"&name="+encodeURIComponent(common.config.filename)+'" target="_blank">点击下载</a>',1);common.setUploadProgress(1);if(frameElement.callback){frameElement.callback({"ret":0,"msg":"上传成功","data":{"filename":common.config.filename,"filekey":common.config.filekey.slice(1),"filesize":common.config.fileSize}})}}},function(){common.setMsg("正在上传文件...",0);common.setUploadProgress(B.Processed/B.FileSize)},function(){}][+B.EventType];A()},"selectFile":function(){var A;if(_plugin){A=_plugin.SelectFiles(window).split(/[\s\r\n]+/g);return A[0]}else{common.setMsg('您需要安装上传控件才能进行上传，点击此处 <a href="http://mail.qq.com/cgi-bin/readtemplate?t=browser_addon&check=false&returnto='+encodeURIComponent(top.location.href)+'" onclick="return common.installActive();">安装上传控件</a>',2);return false}},"getFileInfo":function(){var A;common.config.file=common.selectFile();A=common.config.file.match(/([^\\]+$)/);if(common.config.file){if(/\.apk$/.test(common.config.file)===false){common.setMsg("仅支持apk安装包！",2);return false}common.config.filename=A&&A[1];common.setUploadProgress(0);$("upload_txt").value=common.config.file;$("progress").className="";var B=_plugin.FileSign(common.config.file,855)}},"uploadFile":function(A){if(A.ret===0){A.path=(function(C){var D=C.split("/");D[1]=D&&D[1]&&D[1].substr(0,36);return D.join("/")})(A.path);common.config.filekey=A.path;var B=_plugin.UploadFile(A.ip,A.port||80,A.checkkey,common.config.sha,A.path,common.config.Path,853);common.setMsg("创建文件成功，开始上传...",0)}else{if(A.errcode===3){common.setMsg("您还没有登录，请先登录",2)}else{common.setMsg("创建文件失败，"+A.msg,2)}}},"init":function(){common.getFileInfo()},"setUploadProgress":function(E){var D=$("progress"),C=$("progress_bar"),A=$("progress_bar_percent"),B=D.clientWidth;C.style.width=(E*100)+"%";A.innerHTML=Math.ceil(E*100)+"%";if(E>0.06){A.className="start"}else{A.className=""}},"setMsg":function(C,B){var A=$("panel");B=B||0;A.className=["","yes","no"][B];A.innerHTML=C},"installActive":function(){frameElement.width="100%";frameElement.height=450;parent.ptlogin2_onResize(960,450)}};var _plugin=null;function _isSupportActiveX(){return !(typeof ActiveXObject=="undefined")}function _isFF(){return navigator.userAgent.toLowerCase().indexOf("firefox")>=0}function $(A){return document.getElementById(A)}window.onload=function(){common.initPlugin();$("upload_btn").onclick=common.init;if(!(window.console&&window.console.log)){var A=document.getElementById("console");window.console={"log":function(B){A.value+=B+"\n"},"dir":function(B){A.value+=B+"\n"},"clear":function(){A.value=""}}}};