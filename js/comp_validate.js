if(window.OPEN_VALIDATOR){}var OPEN_VALIDATOR;OPEN_VALIDATOR={isempty:function(){return true},appname_only:true,assname_exists:true,tname:function(A){if(A&&!(/^[a-zA-Z][a-zA-Z0-9_\-]{0,19}$/g.test(A))){return"输入有误"}return true},link:function(A){var B="^((news|telnet|nttp|file|http|ftp|https)://)(([-A-Za-z0-9_]+(\\.[-A-Za-z0-9_]+)*(\\.[-A-Za-z]{2,6}))|([0-9]{1,3}(\\.[0-9]{1,3}){3}))(:[0-9]*)?(/[-A-Za-z0-9_$\\.+!*(),;:@&=?/~#%']*)*";var C=new RegExp(B);if(C.test(A)){return true}else{return"格式错误"}},applink:function(A){if(A){return OPEN_VALIDATOR.link(A)}else{return true}},compname:function(D,E){var B,G,A=E&&E.attr("data-error")||"网站名称",C=E&&E[0].form;D=D.replace(/^\s+|\s$/g,"");E.val(D);G=D.match(/[^ A-Za-z0-9（）()\u4e00-\u9fa5]+/g);B=D.replace(/[^\x00-\xff]/g,"tx").length;$("#comp_name").val(D);if(D&&G){return"##不能含有非法字符"+G.join("")}if(B>0&&B<=14){var H=E.attr("data-only");if(H){if(H==="true"){return true}else{return"此##已被注册"}}else{var F=E.attr("data-default");if(F){if(D==F){return true}else{return 1}}else{return 1}}}else{if(B==0){return"##不能为空"}else{return"##不能超过7个汉字"}}},appnameCheck:function(A,E){var B=E.attr("data-error"),C=E.attr("data-default"),G=E.attr("data-rule"),D={"appname":"/pipes/interfaceserver","compname":"/pipes/interfaceserver"},F={"appname":{"action":"common_query","business_type":"ajax_checkname","appname":encodeURIComponent(A)},"compname":{"action":"common_query","business_type":"ajax_checkcompname","comp_name":encodeURIComponent(A),"comp_type":window.comp_type}};F[G]["random"]=+new Date();if(C!=A){showmsg(1,E,"正在验证"+B+"是否重复...");$.ajax({"type":"get","dataType":"json","url":D[G],"data":F[G],"success":function(I){var H=E.attr("data-working")|0;if(I.error==0){E.attr("data-only",true);showmsg(true,E,"");if(H==2){loginWin.close();setTimeout(function(){$("form input[type='submit']").trigger("click")},500)}E.removeAttr("data-working")}else{E.attr("data-only",false);showmsg(false,E,I.msg);E.removeAttr("data-working");if(H==2){loginWin.close();loginWin.alert("<center>"+I.msg+"</center>")}return false}},"error":function(){E.attr("data-only","false");setTimeout(function(){showmsg(false,E,"验证失败！请检查网络")},100);return false}});return true}else{E.attr("data-only","true");E.removeAttr("data-working");return true}},topicname:function(A,B){if($.trim(A).length==0){return"不能为空"}else{if(/^[^#]{1,20}$/.test($.trim(A))){return true}else{if(/^\s*$/.test(A)){return true}else{if($.trim(A).length>20){return"不能超过20个字符"}else{return"不符合规则"}}}}},appdes:function(A,B){A=$.trim(A);$("#app_description").val(A);if(A.length<=280){return true}else{return"不能超过140个汉字"}},companyname:function(A){if(A.length<=40){return true}if(A.length>40){return"不能超过40个字符"}},assname:function(A,D){var C=D.attr("data-only"),B=D.attr("data-error");if(/^\s*$/.test(A)){return"不能为空"}else{if(!(/^[a-zA-Z][a-zA-Z0-9_\-]{0,19}$/g.test(A))){return"##格式错误"}}if(C){if(C==="true"){return true}else{return"此##不存在"}}else{return 1}},assnameCheck:function(A,E){var B=E.attr("data-error"),C=E.attr("data-default"),G=E.attr("data-rule"),D="/pipes/interfaceserver?t="+(+new Date()),F={"account":A,"action":"common_query","business_type":"ajax_checkacc"};if(C!=A){showmsg(1,E,"检验中...");$.ajax({"type":"post","dataType":"json","url":D,"data":F,"success":function(J){var H=E.attr("data-working")|0,K=+J.ret,I=common.getMsgByRet(K);if(I){E.attr("data-only",false);showmsg(false,E,I);E.removeAttr("data-working");return}if(K===0){E.attr("data-only",true);showmsg(true,E,"");if(H==2){loginWin.close();setTimeout(function(){$("#showcode").trigger("click")},500)}E.removeAttr("data-working")}else{if(K===-1){E.attr("data-only",false);showmsg(false,E,"此"+B+"不存在");E.removeAttr("data-working");if(H==2){loginWin.close();loginWin.alert("<center>此"+B+"不存在</center>")}}}},"error":function(){E.attr("data-only","false");E.removeAttr("data-working");setTimeout(function(){showmsg(false,E,"验证失败！请检查网络")},100)}})}}};function getlen(B){var A=0;for(var C=0;C<B.length;C++){if(B.charCodeAt(C)>255){A+=2}else{A++}}return A}function showmsg(C,B,A){var D;if(!C){D=' <span class="tip tip_err"><span class="tip_icon"></span>'+A+"</span>"}else{if(true===C){D=' <span class="tip tip_ok"><span class="tip_icon"></span></span>'}else{if(1===C){D=' <span class="tip tip_waiting"><span class="tip_icon"></span>'+A+"</span>"}else{if(2===C){D=' <span class="tip">'+A+"</span>"}}}}if(B.parent(".form_input").size()){B.parent(".form_input").parent().find(".tip").remove();B.parent(".form_input").after(D);B.parent(".form_input").parent().find(".inputdes").first().hide()}else{B.parent().find(".tip").remove();B.parent().append(D)}}function compValidateEvent(){$("input[type='text'],textarea").blur(function(){var F,A,E,C,D;F=$(this);F.val($.trim(F.val()));A=F.val();E=F.attr("data-rule");C=F.attr("data-error");if(E=="link"&&A.length>0&&A.search(/http[s]?:\/\//)==-1){A="http://"+A;F.val(A)}if(OPEN_VALIDATOR.hasOwnProperty(E)&&E){if(!$.trim(A)&&E!="tname"&&E!="appdes"&&E!="topicname"&&E!="applink"){C+="不能为空";D=false}else{var B=OPEN_VALIDATOR[E](A,F);if(B==undefined){D=false;C=""}else{if(B===true){D=true}else{if(B===1){return}else{D=false;C=B.replace(/##/g,C)}}}}showmsg(D,F,C)}});$("form input[data-rule='appname'],form input[data-rule='compname'],input[data-rule='assname']").change(function(){var B=$(this),C=B.attr("data-rule"),A=B.val().replace(/\s/g,"");if(C==="assname"){if(/^[a-zA-Z][a-zA-Z0-9_\-]{0,19}$/g.test(A)){B.removeAttr("data-only");B.attr("data-working",1);OPEN_VALIDATOR["assnameCheck"](A,B)}}else{if(/^[A-Za-z0-9（）()\u4e00-\u9fa5]{1,14}$/.test(A)&&A.replace(/^\s+|\s+$/g,"").replace(/[^\x00-\xff]/g,"TX").length<=14){B.removeAttr("data-only");B.attr("data-working",1);OPEN_VALIDATOR["appnameCheck"](A,B)}else{B.removeAttr("data-only")}}});$("#showcode").click(function(){var B,C,A,E,H=true,D="",F=this.form,G=$(F).find("input[data-working]");if(G.size()>0){G.attr("data-working",2);return false}$(".appsArea2 input[type='text'],.appsArea2 textarea,.comp_area input[type='text'],.comp_area textarea").each(function(){A=$(this).attr("data-rule");E=$(this).val();C=$(this).attr("data-error");if(OPEN_VALIDATOR.hasOwnProperty(A)&&A){if(!$.trim(E)&&A!="tname"&&A!="appdes"&&A!="topicname"&&A!="applink"){C+="不能为空";B=false}else{var I=(A==="appname"?OPEN_VALIDATOR.appname_only:true)&&(A==="assname"?OPEN_VALIDATOR.assname_exists:true)&&OPEN_VALIDATOR[A](E,$(this));if(I===true){B=true}else{if(I===1){return}else{B=false;C=I.replace(/##/g,C)}}}H=H&&B;showmsg(B,$(this),C);if(B===false){loginWin.alert("<center>"+C+"</center>")}}});if(H){if(window.formSubmit){window.formSubmit()}}return false});$("input[data-rule='link']").keydown(function(A){if(A.keyCode==13){return false}});$("form").keydown(function(A){if(A.keyCode==13){}});$("form input[type='reset']").click(function(){$(".form_input").next(".errorTip").remove();$(".form_input").next(".currectTip").remove()})}eventBindFuncList.push(compValidateEvent);