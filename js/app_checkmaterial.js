var OPEN_VALIDATOR;OPEN_VALIDATOR={apptypeName:"应用",working:0,isempty:function(){return true},link:function(A){var B="^((news|telnet|nttp|file|http|ftp|https)://)(([-A-Za-z0-9_]+(\\.[-A-Za-z0-9_]+)*(\\.[-A-Za-z]{2,6}))|([0-9]{1,3}(\\.[0-9]{1,3}){3}))(:[0-9]*)?(/[-A-Za-z0-9_$\\.+!*(),;:@&=?/~#%']*)*";var C=new RegExp(B);if(/["'<>]/g.test(A)){return"##不能含有'\"<>"}else{if(C.test(A)){return true}else{return"##格式错误"}}},appstorelink:function(A){var B="^((https|http)://itunes.apple.com)(:[0-9]*)?(/[-A-Za-z0-9_$\\.+!*(),;:@&=?/~#%']*)*";var C=new RegExp(B);if(/["'<>]/g.test(A)){return"##不能含有'\"<>"}else{if(C.test(A)){return true}else{return"请填写苹果官方市场下载地址"}}},androidlink:function(A){var B="^(https://play.google.com/store)(:[0-9]*)?(/[-A-Za-z0-9_$\\.+!*(),;:@&=?/~#%']*)*";var C=new RegExp(B);if(A){if(/["'<>]/g.test(A)){return"##不能含有'\"<>"}else{if(C.test(A)){return true}else{return"##格式错误"}}}else{return true}},appdes:function(A,B){A=$.trim(A);B.val(A);if(A.length>140){return"##不能超过140个汉字"}else{if(A.length<30){return"##不能少于30个汉字"}else{return true}}},wappdes:function(A,B){A=$.trim(A);B.val(A);if(A.length<30){return"##不能少于30个汉字"}else{return true}},installSize:function(A,B){A=$.trim(A);B.val(A);if(new RegExp(/^[\d]+\.?[\d]*([Mm][Bb]?)?$/).test(A)){return true}else{return"##格式不正确"}}};$('<div class="tooltip" id="tooltip"><div class="toolangle"><span class="a1">◆</span><span class="a2">◆</span></div><div class="tooltext"></div></div>').appendTo($("body"));window.tooltip={"timer":null,"show":function(B,D,A){var C=D.offset();$("#tooltip").show().css({"left":C.left,"top":C.top+D.height()}).find(".tooltext").html(B);clearTimeout(tooltip.timer);if(A){tooltip.timer=setTimeout(function(){$("#tooltip").fadeOut()},A)}}};OPEN_VALIDATOR.apptypeName=/iweibo/.test(location.pathname)?"组件":(/platform/.test(location.pathname)?"平台":"应用");$("form input[type='text'],form textarea").blur(function(){var F,A,E,C,D;F=$(this);A=F.val();E=F.attr("data-rule");C=F.attr("data-error");if((/^link|applink$/.test(E))&&A.length>0&&A.search(/http[s]?:\/\//)==-1){A="http://"+A;F.val(A)}if(OPEN_VALIDATOR.hasOwnProperty(E)&&E){if((!$.trim(A)&&E!="tname"&&E!="applink"&&E!="androidlink")||(A=="请选择"&&E=="appsupport")){C+="不能为空";D=false}else{var B=OPEN_VALIDATOR[E](A,F);if(B&&E=="appsupport"){D=OPEN_VALIDATOR["appsupportIsEmpty"]($(this));C+="不能为空"}else{if(B==undefined){D=false;C=""}else{if(B===true){D=true}else{if(B===1){return}else{D=false;C=B.replace(/##/g,C)}}}}}showmsg(D,F,C)}});var submitCallback=function(C){var D=+(C.ret||C.error),B=common.getMsgByRet(D);loginWin.close();if(B){loginWin.alert("<center>"+B+"</center>");return}if(D==0){if(loginWin){$(".app_check").html('<div class="app_check"><label>确认开发者信息</label><i class="active"></i><label>确认'+OPEN_VALIDATOR.apptypeName+'信息</label><i class="active"></i><label>确认'+OPEN_VALIDATOR.apptypeName+'素材</label><i class="active"></i><strong>提交审核</strong></div>');loginWin.alert({"title":"提交审核","width":410,"height":185,"text":'<center><label class="icon_ok"></label> &nbsp; '+OPEN_VALIDATOR.apptypeName+"提交审核成功，审核人员会在两个工作日处理完毕。</center>"},function(){window.location.href=nextURL})}}else{var A="";if(D>100&&D<200){A="图片不合法"}else{if(D>200&&D<300){A="参数非法"}else{A=C.msg||"未知原因"}}if(loginWin){loginWin.show({"title":"提交审核","width":410,"height":185,"text":'<center><br/><label class="icon_alert"></label> &nbsp; '+OPEN_VALIDATOR.apptypeName+"提交审核因为&nbsp;<strong>"+A+'</strong>&nbsp;失败，请稍后再试。<br/><input type="button" class="devSubmit closeBtn" value="确定"/></center>'});loginWin.contentarea.find(".closeBtn").bind("click",function(){loginWin.close()})}}};var submitMaterialCallBack=function(C){var D=+(C.ret||C.error),B=common.getMsgByRet(D),A='<div style="text-align:center;margin:30px 0 10px;">'+B+'</div><div style="text-align:center;"><a href="javascript:;" class="devSubmit closeBtn">确定</a></div>';loginWin.close();if(B){loginWin.show({"title":"提示","width":410,"height":185,"text":A});loginWin.contentarea.find(".closeBtn").bind("click",function(){common.showLoginWin()});return}};function showmsg(C,B,A){var D;if(!C){D=' <span class="tip tip_err"><span class="tip_icon"></span>'+A+"</span>"}else{if(true===C){D=' <span class="tip tip_ok"><span class="tip_icon"></span></span>'}else{if(1===C){D=' <span class="tip tip_waiting"><span class="tip_icon"></span>'+A+"</span>"}else{if(2===C){D=' <span class="tip">'+A+"</span>"}}}}if(B.parent(".form_input").size()){B.parent(".form_input").parent().find(".tip").remove();B.parent(".form_input").after(D);B.parent(".form_input").parent().find(".inputdes").first().hide()}else{if(B.parent(".form_element").size()){B.parent(".form_element").parent().find(".tip").remove();B.parent(".form_element").after(D);B.parent(".form_element").parent().find(".inputdes").first().hide()}else{B.parent().find(".tip").remove();B.parent().append(D)}}}$(function(){$('<div class="tooltip" id="tooltip"><div class="toolangle"><span class="a1">◆</span><span class="a2">◆</span></div><div class="tooltext"></div></div>').appendTo($("body"));var A={"timer":null,"show":function(C,E,B){var D=E.offset();$("#tooltip").show().css({"left":D.left,"top":D.top+E.height()}).find(".tooltext").html(C);E.get(0).scrollIntoView(true);clearTimeout(A.timer);if(B){A.timer=setTimeout(function(){$("#tooltip").fadeOut()},B)}}};$("input[type='file']").change(function(){var K=this.files&&this.files[0],Q=$(this),D=$(this).parent().find("img")[0],B=$(this).parent().find("img"),J=new Image(),O="",N=Q.attr("_size")||500,P=Q.hasClass("png_jpg")?2:1,G=P==2?new RegExp(/\.(png|jpeg|jpg)$/i):new RegExp(/\.(png)$/i),C=P==2?new RegExp(/^image\/(png|jpeg)$/i):new RegExp(/^image\/(png)$/i),H=P==2?"jpg/png":"png",E=function(){setTimeout(function(){B.removeAttr("src").attr("src","http://mat1.gtimg.com/app/opent/images/websites/0.gif");Q.val("")},100)},M=function(R){loginWin.alert({"text":'<div style="margin:0 0 0 30px;">由于您的浏览器安全限制，'+R+'<br/>请将本站( <span style="color:red;font-weight:bold;">'+location.href.slice(0,location.href.indexOf(location.pathname)+1)+'</span> )添加到受信任的站点列表中 <br/>点击此处了解 <a href="http://open.t.qq.com/bbs/forum.php?mod=viewthread&tid=21271" target="_blank">如何将本站添加到受信任的站点列表中？</a></div><div style="color:#090;margin:0 30px;">您也可以使用非IE内核浏览器，如chrome、firefox（Safari暂不支持）</div>',"width":460,"height":200});E()},F=function(){D.src="http://mat1.gtimg.com/app/opent/images/websites/0.gif";var R=setTimeout(function(){if(+(J.width||"")===0||+(J.height||"")===0){M("无法获取图片大小");Q.attr("data-error",O);return}},200);J.onload=function(){if(this.complete){return false}if(G.test(J.src)==false){O="你上传的图片不是有效的"+H+"格式图片";loginWin.alert("<center>"+O+"</center>");Q.attr("data-error",O);E();return}else{if(J.fileSize/1024>N){O="文件大小不能超过"+N+"K，请重新选择";loginWin.alert("<center>"+O+"</center>");Q.attr("data-error",O);E();return}else{if(B.attr("_width")&&B.attr("_width")){if(+(J.width||"")===0||+(J.height||"")===0){M("无法获取图片大小");Q.attr("data-error",O);E();return}else{if(J.width!=B.attr("_width")||J.height!=B.attr("_height")){O="你上传的图片尺寸"+J.width+"×"+J.height+"不符合要求，请选择一张"+B.attr("_width")+"×"+B.attr("_height")+"大小的"+H+"图片";Q.attr("data-error",O);O+='<div style="border-top:1px dashed #ccc;margin-top:5px;padding-top:5px;"><strong>如果你的图片尺寸符合要求但仍然看到该提示，你可以：</strong><br/>1、如果你的浏览器是双核浏览器，可以切换到极速模式重新上传<br/>2、如果你的浏览器不是双核浏览器，可以使用其它浏览器，如chrome或firefox</div>';loginWin.alert({"text":'<div style="margin:0 25px;">'+O+"</center>","width":500,"height":215});Q.attr("data-error",O);E();return}}}}}D.src=J.src;Q.removeAttr("data-error");this.onload=null};J.onerror=function(){O="读取图片失败，浏览器不支持直接读取图片";M("加载图片失败");Q.attr("data-error",O);J.onerror=null;E();return};J.src=Q[0].value;return},L=function(){O="你的浏览器不支持fileReader，无法预览图片<br/>建议使用firefox或chrome浏览器或升级您当前的浏览器至最新版本";loginWin.alert({"text":"<center>"+O+"</center>","height":170});Q.attr("data-error",O);E();return},I=function(){var S=new FileReader(),T=function(U){return function(W){for(var V in U){U[V].src=W.target.result}}},R=false;S.onload=T([D,J]);S.readAsDataURL(K);T([D]);if(B.attr("_width")&&B.attr("_width")){(function(){var V=arguments.callee,U=arguments[0];if((((J.width||J.height)|0)==0)&&(U<10)){setTimeout(function(){V(++U)},100);return}if((J.width!=B.attr("_width")||J.height!=B.attr("_height"))&&!R){O="你上传的图片尺寸"+J.width+"×"+J.height+"不符合要求<br/>请选择一张"+B.attr("_width")+"×"+B.attr("_height")+"大小的"+H+"图片";D.src="http://mat1.gtimg.com/app/opent/images/websites/0.gif";loginWin.alert({"text":"<center>"+O+"</center>","height":160});Q.attr("data-error",O);E();return}Q.removeAttr("data-error")})(0)}if(C.test(K.type)&&(K.fileSize||K.size)/1024<=N){}else{if(C.test(K.type)==false){O="你上传的图片不是有效的"+H+"格式图片";R=true;loginWin.alert("<center>"+O+"</center>");Q.attr("data-error",O);E();return false}else{if((K.fileSize||K.size)/1024>N){O="文件大小不能超过"+N+"K，请重新选择";R=true;loginWin.alert("<center>"+O+"</center>");Q.attr("data-error",O);E();return false}else{Q.removeAttr("data-error");return true}}}};if(window.FileReader){return I()}else{if(document.all){return F()}else{return L()}}});$("input#devSubmit").click(function(){if(global_obj.data.app.app_type!==6){var E=true,K="";$("input[type='file']").each(function(){var R=$(this).parent().find("img");if((!$(this).val()&&!$(this).attr("data-default").replace("NULL",""))||$(this).attr("data-error")){E=false;K="<center>请选择一张"+R.attr("_width")+"×"+R.attr("_height")+"的png图片</center>";$(this).prev(".uploadbtn")[0].scrollIntoView(true);loginWin.alert(K);A.show(K,$(this).prev(".uploadbtn"),2000);return false}});if(!E){return false}}else{var L=this.form,N=$(L).find("input[data-working]");if(N.size()>0){N.attr("data-working",2);return false}var M=$.trim($(this).attr("data-rule")),O=+$("#app_platform").val();if(M=="formauto"){if($(L).hasClass("wirelessappform")&&O===0){loginWin.alert("<center>请至少选择一个平台</center>");return false}var D=this.form,G,P,C,J,F=true,H="",E=true;$("form input[type='text'],form input[type='hidden'],form textarea,select#app_class_main,select#app_class_child,form input[type='file'][data-default]^=''").each(function(){if($(L).hasClass("wirelessappform")){if(O===1){if($.contains($("#androidContainer")[0],$(this)[0])){return}}if(O===2){if($.contains($("#iphoneContainer")[0],$(this)[0])){return}}}C=$(this).attr("data-rule"),J=$(this).val(),P=$(this).attr("data-error");if(OPEN_VALIDATOR.hasOwnProperty(C)&&C){if((!$.trim(J)&&C!="tname"&&C!="applink"&&C!="androidlink")||(J=="请选择"&&C=="appsupport")){P+="不能为空";G=false}else{var R=OPEN_VALIDATOR[C](J,$(this));if(R&&C=="appsupport"){G=OPEN_VALIDATOR["appsupportIsEmpty"]($(this));P+="不能为空"}else{if(R===true){G=true}else{if(R===1){return}else{G=false;P=R.replace(/##/g,P)}}}}showmsg(G,$(this),P);if(F&&!G){loginWin.alert("<center>"+P+"</center>")}F=F&&G}else{if($(L).hasClass("wirelessappform")&&$(this).hasClass("required")){if((!$(this).val()&&!$(this).attr("data-default").replace("NULL",""))||$(this).attr("data-error")){E=false;K="<center>请上传"+$(this).attr("data-label")+"</center>";$(this).prev(".uploadbtn")[0].scrollIntoView(true);if(F){loginWin.alert(K)}A.show(K,$(this).prev(".uploadbtn"),2000);F=F&&E;return false}}}});if(!F){return F}if($(L).hasClass("wirelessappform")){var I=$("input[name='appplatform']");if($("input[name='appplatform']:checked").length==0){showmsg(false,$("#iphone_pf"),"请至少选择一个平台");loginWin.alert("<center>请至少选择一个平台</center>");return false}}}}var Q=$("input[name='user_agree']");if(Q.size()===0){if(F){$("form").submit()}else{return false}}else{if(Q.not(":checked").size()>0){loginWin.alert("<center>您尚未同意《"+(Q.not(":checked").attr("agreement")||"腾讯微博开放平台开发者服务协议")+"》</center>");return false}else{$("form").submit();return false}}var B=confirm("审核结果返回前，将不能修改"+OPEN_VALIDATOR.apptypeName+"信息，确定将此"+OPEN_VALIDATOR.apptypeName+"提交审核？");if(!B){return B}loginWin.show({"title":"提交审核","width":410,"height":120,"text":"<div style='text-align:center;line-height:59px;'>数据提交中，请勿操作或关闭浏览器窗口</div>"});return true})});