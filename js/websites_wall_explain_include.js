this.tpl=this.tpl||{};var sty=[".colorList li,.colorList1 li{float:left;height:40px;padding:4px;margin-bottom:8px;}",".color1, .color2, .color3, .color4, .color5, .color6, .color7 {height: 36px;margin: 1px;width: 36px;}",".colorList li, .colorList1 li{height:38px;padding:0;margin:4px 10px 0 0;border-radius:4px;}",".colorList1 li.s{border: 4px solid #A8DE86;margin-top:0;}",].join("");util.createStyle(sty);tpl.websites_wall_explain_include=['<link href="http://mat1.gtimg.com/app/opent/css/websites/show/customcolor.css" type="text/css" rel="stylesheet">','<div class="comp_area">','<div id="show" class="show_wall">',"<h3>效果预览</h3>",'<div style="width:100%;height:601px;overflow:auto">','<iframe id="review" frameborder="0" marginwidth=0 marginheight=0 scrolling="no" src="http://mat1.gtimg.com/app/opent/images/websites/show.png" width="345" height="594"></iframe>',"</div>","</div>",'<dl class="p" style="_margin-top:-20px;">',"<dt>话题定制</dt>",'<dd  style="width:332px;"><span class="form_input"><input type="text" id="t1" name="topicname" placeholder="请输入话题名称" data-rule="topicname" data-error="话题名称"/></span></dd>',"</dl>",'<dl class="p">',"<dt>添加来源</dt>",'<dd  style="width:332px;"><span class="form_input"><input type="text" id="originurl" name="originurl" placeholder="请输入网站url" data-rule="link" data-error="来源网址"/></span></dd>',"</dl>",'<dl class="p">',"<dt>推荐官号</dt>",'<dd  style="width:332px;"><span class="form_input"><input type="text" id="wbname" name="wbname" placeholder="请输入官号英文账号" data-rule="tname" data-error=""/></span></dd>',"</dl>",'<dl class="p">',"<dt>- 尺寸</dt>",'<dd>宽：<span class="form_input"><input type="text" id="width" maxlength="4" class="winput" value="345" /></span> px</dd>','<dd>高：<span class="form_input"><input type="text" id="height" maxlength="4" class="winput" value="590" /></span> px</dd>',"<dt>- 颜色</dt>","<dd>",'<input type="radio" id="defaultColor" checked="checked" name="color" value="0"/> <label for="defaultColor">默认颜色</label>','<ul id="colorList" class="colorList1">','<li class="s" data-color="4"><div class="color1" style="background:#F7FBFD;"></div></li>','<li data-color="1"><div class="color2" style="background:#333333;"></div></li>',"</ul>",'<div style="clear:both;height:1px;"></div>',"</dd>","<dt>- 显示图片</dt>","<dd>",'<input type="radio" name="imgshow" value="1" checked="checked" id="imgshow1"/> <label for="imgshow1">显示缩略图</label> &nbsp; &nbsp;','<input type="radio" name="imgshow" value="0" id="imgshow2"/> <label for="imgshow2">显示为图标</label>',"</dd>","<dt>- 发表框</dt>","<dd>",'<input type="radio" name="post" value="1" checked="checked" id="setPost1"/> <label for="setPost1">居上</label> &nbsp; &nbsp;','<input type="radio" name="post" value="0" id="setPost0"/> <label for="setPost0">居下</label> &nbsp; &nbsp;','<input type="radio" name="post" value="2" id="setPost2"/> <label for="setPost2">不显示</label> &nbsp; &nbsp;',"</dd>","<dt>- 滚动条</dt>","<dd>",'<input type="radio" name="tmodel" value="5" checked="checked" id="tmodel1"/> <label for="tmodel1">有</label> &nbsp; &nbsp;','<input type="radio" name="tmodel" value="0" id="tmodel2"/> <label for="tmodel2">无</label>',"</dd>","</dl>","</div>"].join("");var _width=345;var _height=590;var _opt=7;var comp_type=3;eventBindFuncList.push(function(){$("input[name='topicname']").change(function(){crUrl(false)});$("#wbname").change(function(){crUrl(false)});$("#width").blur(function(){theval=$(this).val();if(theval<255){$(this).val(255)}if(theval>1024){$(this).val(1024)}_width=parseInt($(this).val());crUrl(false)}).keyup(function(){var a=$(this).val();$(this).val(a.replace(/[^\d]{0,4}/g,""))});$("#height").blur(function(){theval=$(this).val();if(theval<300){$(this).val(300)}if(theval>800){$(this).val(800)}_height=$(this).val();crUrl(false)}).keyup(function(){var a=$(this).val();$(this).val(a.replace(/[^\d]{0,4}/g,""))});$("#colorList li").each(function(a){$(this).click(function(){$("#colorList li").removeClass("s");$(this).addClass("s");crUrl()})});$("input[name=imgshow]").click(function(){crUrl(false)});$("input[name=post]").click(function(a){crUrl(false)});$("input[name=tmodel]").click(function(a){crUrl(false)});$("input[name='color']").click(function(){$("#colorList,#customcolor").hide();if($(this).val()==0){$(this).parent().find("li:eq(0)").trigger("click")}$(this).parent().find("ul").show()})});function crUrl(d){if($.trim($("input#t1").val()).length==0){return false}var e=[],h=$("input[name='color']:checked").val()*4,a=$("#colorList li.s").attr("data-color")-0||4;if($("#t1").size()&&$("#t1").val()!=""){e.push(encodeURIComponent($.trim($("#t1").val())))}if(e.length==0){return false}else{var b=e.join("")}var j=window.comp&&comp.comp_id?comp.comp_id:"801000271";var c=encodeURIComponent($.trim($("#wbname").val()));var g=encodeURIComponent($.trim($("#originurl").val()));if(b!=""&&j!=""){$("#review").show();$("#showImgs").hide()}else{$("#review").hide();$("#showImgs").show()}var i="http://wall.v.t.qq.com/index.php?c=wall&a=index&t="+b;if(_width){_width=parseInt($("#width").val())}_height=parseInt($("#height").val());i+="&ak="+j;i+="&w="+[_width,"0"][0+$("#autowidth").is(":checked")];i+="&h="+_height;i+="&n="+c;i+="&url="+g;i+="&o="+function(){var k=7;switch(+$("input[name='imgshow']:checked").val()||0){case 0:k&=~parseInt(1<<1,"0x");break;case 1:k|=parseInt(1<<1,"0x");break}switch(+$("input[name='post']:checked").val()||0){case 0:k|=parseInt(1<<3,"0x");k|=parseInt(1<<2,"0x");break;case 1:k&=~parseInt(1<<3,"0x");k|=parseInt(1<<2,"0x");break;default:k&=~parseInt(1<<2,"0x")}switch(+$("input[name='tmodel']:checked").val()||0){case 0:k&=~parseInt(1<<5,"0x");break;case 5:k|=parseInt(1<<5,"0x");break}return k}();var f=[];if(h==4){i+="&s="+h;$("#customcolor").find("input").each(function(){f.push($(this).val().replace("#",""))});f=f.join("_");i+="&cs=";i+=f}else{i+="&s="+a}iframewidth=[_width,"100%"][0+$("#autowidth").is(":checked")];if(d){$("#review").attr("width",iframewidth).attr("height",_height)}else{$("#review").attr("src",i).attr("width",iframewidth).attr("height",_height)}}function formSubmit(){if($("#showcode").attr("disabled")){return}var d=[],c=[];$("input[name='topicname']").each(function(){if(/^[^#]{1,20}$/.test($.trim($(this).val()))){d.push(encodeURIComponent($.trim($(this).val())))}});$("#customcolor").find("input").each(function(){c.push($(this).val().replace("#",""))});var g=+$("input[name='tmodel']:checked").val(),e=encodeURIComponent($.trim($("#wbname").val())),f=encodeURIComponent($.trim($("#originurl").val())),a=$("#colorList li.s").attr("data-color");var b={comp_type:3,comp_style:'{"topicnames":"'+d.join("")+'","width":'+$("#width").val()+',"height":'+$("#height").val()+',"autowidth":'+$("#autowidth").is(":checked")+',"colorstyle":'+$("input[name='color']:checked").val()+',"defaultcolorstyle":'+a+',"customcolor":"'+c.join("_")+'","imgshow":'+$("input[name='imgshow']:checked").val()+',"postpos":'+$("input[name='post']:checked").val()+',"tmodel": '+g+' , "wbname" : "'+e+'", "wburl":"'+f+'"}'};if(window.comp&&comp.comp_id){b.comp_id=comp.comp_id}if($("#comp_url").size()&&$("#comp_name").size()){b.comp_url=encodeURIComponent($("#comp_url").val());b.comp_name=encodeURIComponent($("#comp_name").val())}if(d.length==0){loginWin.show({title:"获取代码失败！",width:240,height:120,text:"<center><br/>请至少指定一个需要定制的话题</center>"});return}if(window.comp){b.comp_id=comp.comp_id}$("#showcode").attr("disabled","disabled");$.ajax({type:"post",url:"/pipes/interfaceserver?action=common_query&business_type=ajax_compadd&t="+new Date().getTime(),data:b,dataType:"json",success:function(i){var h=+i.ret,j=common.getMsgByRet(h);if(j){loginWin.alert("<center>"+j+"</center>");return}if(h===0&&i.data&&i.data.id){location.href="/development/compinfo?comp_id="+i.data.id}else{loginWin.alert({title:"获取代码失败！",width:450,text:"<center>"+(i.msg||"服务器失败")+"</center>"})}$("#showcode").removeAttr("disabled")},error:function(h){loginWin.show({title:"获取代码失败！",width:340,text:"<center>连接服务器失败</center>"});setTimeout(function(){loginWin.close()},2000);$("#showcode").removeAttr("disabled")}})}function normalValidate(){$("#comp_name").trigger("blur")}util.createScript("http://mat1.gtimg.com/app/opent/rebuild/js/comp_validate.js",function(){bindAllEvent()});