$(function(){var A=function(){var B=0;if($("#iphone_pf").attr("checked")&&$("#android_pf").attr("checked")){B=3}else{if($("#iphone_pf").attr("checked")){B=1}else{if($("#android_pf").attr("checked")){B=2}}}$("input[name='app_platform']").val(B);return B};$("input[name='appplatform']").each(function(B){if($(this).attr("checked")){$(".paltform_container").eq(B).show()}else{$(".paltform_container").eq(B).hide()}});$("input[name='appplatform']").change(function(){if($(this).attr("checked")){$(this).parent(".form_platform").next(".paltform_container").show();if($("input[name='appplatform']").not(":checked").length>0){$("input[name='appplatform']").not(":checked").next(".paltform_container").hide()}}else{if($("input[name='appplatform']:checked").length==0){loginWin.alert("<center>请至少选择一个平台</center>")}else{}$(this).parent(".form_platform").next(".paltform_container").hide()}A()});$("input[type=file]").change(function(){$("input#img_need_post").val("1")});$(".synchroPlatform").click(function(){var H=$(this).attr("_platform"),C=$("#app_downurl_"+H),G=C.val(),B=$("#app_marketurl"),D=H==1?"":B.val(),E="",I=true;C.trigger("blur");if(H==2){B.trigger("blur")}if(C.parent(".form_input").next(".tip_err").size()){E=C.parent(".form_input").next(".tip_err").text();I=false}if(H==2&&B.parent(".form_input").next(".tip_err").size()){if(E==""){E=B.parent(".form_input").next(".tip_err").text()}}if(E){loginWin.alert("<center>"+E+"</center>");return false}var F=$("#btn_SynchroInfo_"+H);showmsg(1,F,"正在同步信息");F.attr("disabled","disabled").css("background-color","#eee");$.ajax({"dataType":"json","type":"post","url":"/development/dospider?t="+(+new Date()),"data":{"app_id":appid,"app_platform":H,"app_downurl":G,"app_marketurl":D},"success":function(K){var L=+K.ret,J=common.getMsgByRet(L);if(J){loginWin.alert("<center>"+J+"</center>");return}if(L===0||L===3){if(L===0){showmsg(true,F,"信息同步成功")}else{if(L===3){showmsg(false,F,"部分信息同步失败")}}F.removeAttr("disabled").css("background-color","#D6EEF6");if(K.msg.app_description){$("#app_description_"+H).val(K.msg.app_description)}if(K.msg.app_version){$("#app_version_"+H).val(K.msg.app_version)}if(K.msg.app_size){$("#app_size_"+H).val(K.msg.app_size)}if(K.msg.app_score){$("#app_score_"+H).text(K.msg.app_score)}if(K.msg.app_pic1){$("#app_pic1_"+H).attr("src",K.msg.app_pic1);$("#wpic1_"+H).attr("data-default",K.msg.app_pic1)}if(K.msg.app_pic2){$("#app_pic2_"+H).attr("src",K.msg.app_pic2);$("#wpic2_"+H).attr("data-default",K.msg.app_pic2)}if(K.msg.app_pic3){$("#app_pic3_"+H).attr("src",K.msg.app_pic3);$("#wpic3_"+H).attr("data-default",K.msg.app_pic3)}if(K.msg.app_pic4){$("#app_pic4_"+H).attr("src",K.msg.app_pic4);$("#wpic4_"+H).attr("data-default",K.msg.app_pic4)}if(K.msg.app_pic5){$("#app_pic5_"+H).attr("src",K.msg.app_pic5);$("#wpic5_"+H).attr("data-default",K.msg.app_pic5)}}else{if(L===1){showmsg(false,F,"填写Google Play地址才可同步信息");F.removeAttr("disabled").css("background-color","#D6EEF6");return}else{showmsg(false,F,"信息同步失败，请重试或手动填写");F.removeAttr("disabled").css("background-color","#D6EEF6");return}}},"error":function(){showmsg(false,F,"信息同步失败，请重试");F.removeAttr("disabled").css("background-color","#D6EEF6");return}})});(function(){var E=$("#app_apk_uploader"),C=$("input[name='app_apk']"),B=$(".form_button_upload"),G=$(".form_element_uploaded_name"),D=$(".form_element_uploaded"),F=$("#app_size_2"),H=function(J){C.val(J.filekey);F.val((J.filesize/1024/1024).toFixed(2));B.addClass("none");D.removeClass("none").find(".form_element_uploaded_name").html(J.filename);G.html('<a href="http://app.t.qq.com/download.php?key='+J.filekey+"&name="+global_obj.data.app.app_id+'.apk" target="_blank" title="点击下载">'+global_obj.data.app.app_id+".apk</a>");showmsg(true,C)},I=function(){D.addClass("none");B.removeClass("none");C.val("").removeAttr("data-default");showmsg(false,C,"请上传apk安装文件")};E.bind("click",function(){var J;loginWin.show({"text":'<iframe src="/html/upload.html" width="400" height="140" scrollong=no frameborder=0></iframe>',"width":400,"height":180,"title":"文件上传"});J=loginWin.win.find("iframe")[0];J.callback=function(K){$("#app_downurl_2").val(K.data.filekey);loginWin.close();if(K.ret===0){H(K.data)}};J.errorcallback=function(){I()}});D.find(".form_element_uploaded_del").bind("click",I)})()});