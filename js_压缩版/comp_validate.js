if(window.OPEN_VALIDATOR){}var OPEN_VALIDATOR;OPEN_VALIDATOR={isempty:function(){return true},appname_only:true,assname_exists:true,tname:function(a){if(a&&!(/^[a-zA-Z][a-zA-Z0-9_\-]{0,19}$/g.test(a))){return"输入有误"}return true},link:function(b){var c="^((news|telnet|nttp|file|http|ftp|https)://)(([-A-Za-z0-9_]+(\\.[-A-Za-z0-9_]+)*(\\.[-A-Za-z]{2,6}))|([0-9]{1,3}(\\.[0-9]{1,3}){3}))(:[0-9]*)?(/[-A-Za-z0-9_$\\.+!*(),;:@&=?/~#%']*)*";var a=new RegExp(c);if(a.test(b)){return true}else{return"格式错误"}},applink:function(a){if(a){return OPEN_VALIDATOR.link(a)}else{return true}},compname:function(f,a){var b,e,h=a&&a.attr("data-error")||"网站名称",d=a&&a[0].form;f=f.replace(/^\s+|\s$/g,"");a.val(f);e=f.match(/[^A-Za-z0-9（）()\u4e00-\u9fa5]+/g);b=f.replace(/[^\x00-\xff]/g,"tx").length;$("#comp_name").val(f);if(f&&e){return"##不能含有非法字符"+e.join("")}if(b>0&&b<=14){var c=a.attr("data-only");if(c){if(c==="true"){return true}else{return"此##已被注册"}}else{var g=a.attr("data-default");if(g){if(f==g){return true}else{return 1}}else{return 1}}}else{if(b==0){return"##不能为空"}else{return"##不能超过7个汉字"}}},appnameCheck:function(e,b){var d=b.attr("data-error"),g=b.attr("data-default"),f=b.attr("data-rule"),c={appname:"/pipes/interfaceserver",compname:"/pipes/interfaceserver"},a={appname:{action:"common_query",business_type:"ajax_checkname",appname:encodeURIComponent(e)},compname:{action:"common_query",business_type:"ajax_checkcompname",comp_name:encodeURIComponent(e),comp_type:window.comp_type}};a[f]["random"]=+new Date();if(g!=e){showmsg(1,b,"正在验证"+d+"是否重复...");$.ajax({type:"get",dataType:"json",url:c[f],data:a[f],success:function(i){var h=b.attr("data-working")|0;if(i.error==0){b.attr("data-only",true);showmsg(true,b,"");if(h==2){loginWin.close();setTimeout(function(){$("form input[type='submit']").trigger("click")},500)}b.removeAttr("data-working")}else{b.attr("data-only",false);showmsg(false,b,i.msg);b.removeAttr("data-working");if(h==2){loginWin.close();loginWin.alert("<center>"+i.msg+"</center>")}return false}},error:function(){b.attr("data-only","false");setTimeout(function(){showmsg(false,b,"验证失败！请检查网络")},100);return false}});return true}else{b.attr("data-only","true");b.removeAttr("data-working");return true}},topicname:function(b,a){if($.trim(b).length==0){return"不能为空"}else{if(/^[^#]{1,20}$/.test($.trim(b))){return true}else{if(/^\s*$/.test(b)){return true}else{if($.trim(b).length>20){return"不能超过20个字符"}else{return"不符合规则"}}}}},appdes:function(b,a){b=$.trim(b);$("#app_description").val(b);if(b.length<=280){return true}else{return"不能超过140个汉字"}},companyname:function(a){if(a.length<=40){return true}if(a.length>40){return"不能超过40个字符"}},assname:function(d,a){var c=a.attr("data-only"),b=a.attr("data-error");if(/^\s*$/.test(d)){return"不能为空"}else{if(!(/^[a-zA-Z][a-zA-Z0-9_\-]{0,19}$/g.test(d))){return"##格式错误"}}if(c){if(c==="true"){return true}else{return"此##不存在"}}else{return 1}},assnameCheck:function(e,b){var d=b.attr("data-error"),g=b.attr("data-default"),f=b.attr("data-rule"),c="/pipes/interfaceserver?t="+(+new Date()),a={account:e,action:"common_query",business_type:"ajax_checkacc"};if(g!=e){showmsg(1,b,"检验中...");$.ajax({type:"post",dataType:"json",url:c,data:a,success:function(k){var h=b.attr("data-working")|0,i=+k.ret,j=common.getMsgByRet(i);if(j){b.attr("data-only",false);showmsg(false,b,j);b.removeAttr("data-working");return}if(i===0){b.attr("data-only",true);showmsg(true,b,"");if(h==2){loginWin.close();setTimeout(function(){$("#showcode").trigger("click")},500)}b.removeAttr("data-working")}else{if(i===-1){b.attr("data-only",false);showmsg(false,b,"此"+d+"不存在");b.removeAttr("data-working");if(h==2){loginWin.close();loginWin.alert("<center>此"+d+"不存在</center>")}}}},error:function(){b.attr("data-only","false");b.removeAttr("data-working");setTimeout(function(){showmsg(false,b,"验证失败！请检查网络")},100)}})}}};function getlen(c){var a=0;for(var b=0;b<c.length;b++){if(c.charCodeAt(b)>255){a+=2}else{a++}}return a}function showmsg(b,a,d){var c;if(!b){c=' <span class="tip tip_err"><span class="tip_icon"></span>'+d+"</span>"}else{if(true===b){c=' <span class="tip tip_ok"><span class="tip_icon"></span></span>'}else{if(1===b){c=' <span class="tip tip_waiting"><span class="tip_icon"></span>'+d+"</span>"}else{if(2===b){c=' <span class="tip">'+d+"</span>"}}}}if(a.parent(".form_input").size()){a.parent(".form_input").parent().find(".tip").remove();a.parent(".form_input").after(c);a.parent(".form_input").parent().find(".inputdes").first().hide()}else{a.parent().find(".tip").remove();a.parent().append(c)}}function compValidateEvent(){$("input[type='text'],textarea").blur(function(){var e,c,d,f,a;e=$(this);e.val($.trim(e.val()));c=e.val();d=e.attr("data-rule");f=e.attr("data-error");if(d.indexOf("link")!=-1&&c.length>0&&c.search(/http[s]?:\/\//)==-1){c="http://"+c;e.val(c)}if(OPEN_VALIDATOR.hasOwnProperty(d)&&d){if(!$.trim(c)&&d!="tname"&&d!="appdes"&&d!="topicname"&&d!="applink"){f+="不能为空";a=false}else{var b=OPEN_VALIDATOR[d](c,e);if(b==undefined){a=false;f=""}else{if(b===true){a=true}else{if(b===1){return}else{a=false;f=b.replace(/##/g,f)}}}}showmsg(a,e,f)}});$("form input[data-rule='appname'],form input[data-rule='compname'],input[data-rule='assname']").change(function(){var a=$(this),c=a.attr("data-rule"),b=a.val().replace(/\s/g,"");if(c==="assname"){if(/^[a-zA-Z][a-zA-Z0-9_\-]{0,19}$/g.test(b)){a.removeAttr("data-only");a.attr("data-working",1);OPEN_VALIDATOR.assnameCheck(b,a)}}else{if(/^[A-Za-z0-9（）()\u4e00-\u9fa5]{1,14}$/.test(b)&&b.replace(/^\s+|\s+$/g,"").replace(/[^\x00-\xff]/g,"TX").length<=14){a.removeAttr("data-only");a.attr("data-working",1);OPEN_VALIDATOR.appnameCheck(b,a)}else{a.removeAttr("data-only")}}});$("#showcode").click(function(){var b,i,g,e,a=true,d="",c=this.form,h=$(c).find("input[data-working]");if(h.size()>0){h.attr("data-working",2);return false}$(".appsArea2 input[type='text'],.appsArea2 textarea,.comp_area input[type='text'],.comp_area textarea").each(function(){g=$(this).attr("data-rule");e=$(this).val();i=$(this).attr("data-error");if(OPEN_VALIDATOR.hasOwnProperty(g)&&g){if(!$.trim(e)&&g!="tname"&&g!="appdes"&&g!="topicname"&&g!="applink"){i+="不能为空";b=false}else{var f=(g==="appname"?OPEN_VALIDATOR.appname_only:true)&&(g==="assname"?OPEN_VALIDATOR.assname_exists:true)&&OPEN_VALIDATOR[g](e,$(this));if(f===true){b=true}else{if(f===1){return}else{b=false;i=f.replace(/##/g,i)}}}a=a&&b;showmsg(b,$(this),i);if(b===false){loginWin.alert("<center>"+i+"</center>")}}});if(a){if(window.formSubmit){window.formSubmit()}}return false});$("input[data-rule='link']").keydown(function(a){if(a.keyCode==13){return false}});$("form").keydown(function(a){if(a.keyCode==13){}});$("form input[type='reset']").click(function(){$(".form_input").next(".errorTip").remove();$(".form_input").next(".currectTip").remove()})}eventBindFuncList.push(compValidateEvent);