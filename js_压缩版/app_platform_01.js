$(function(){var a=function(){var b=0;if($("#iphone_pf").attr("checked")&&$("#android_pf").attr("checked")){b=3}else{if($("#iphone_pf").attr("checked")){b=1}else{if($("#android_pf").attr("checked")){b=2}}}$("input[name='app_platform']").val(b);return b};$("input[name='appplatform']").each(function(b){if($(this).attr("checked")){$(".paltform_container").eq(b).show()}else{$(".paltform_container").eq(b).hide()}});$("input[name='appplatform']").change(function(){if($(this).attr("checked")){$(this).parent(".form_platform").next(".paltform_container").show();if($("input[name='appplatform']").not(":checked").length>0){$("input[name='appplatform']").not(":checked").next(".paltform_container").hide()}}else{if($("input[name='appplatform']:checked").length==0){loginWin.alert("<center>请至少选择一个平台</center>")}else{}$(this).parent(".form_platform").next(".paltform_container").hide()}a()});$("input[type=file]").change(function(){$("input#img_need_post").val("1")});$(".synchroPlatform").click(function(){var c=$(this).attr("_platform"),h=$("#app_downurl_"+c),d=h.val(),i=$("#app_marketurl"),g=c==1?"":i.val(),f="",b=true;h.trigger("blur");if(c==2){i.trigger("blur")}if(h.parent(".form_input").next(".tip_err").size()){f=h.parent(".form_input").next(".tip_err").text();b=false}if(c==2&&i.parent(".form_input").next(".tip_err").size()){if(f==""){f=i.parent(".form_input").next(".tip_err").text()}}if(f){loginWin.alert("<center>"+f+"</center>");return false}var e=$("#btn_SynchroInfo_"+c);showmsg(1,e,"正在同步信息");e.attr("disabled","disabled").css("background-color","#eee");$.ajax({dataType:"json",type:"post",url:"/development/dospider?t="+(+new Date()),data:{app_id:appid,app_platform:c,app_downurl:d,app_marketurl:g},success:function(k){var j=+k.ret,l=common.getMsgByRet(j);if(l){loginWin.alert("<center>"+l+"</center>");return}if(j===0||j===3){if(j===0){showmsg(true,e,"信息同步成功")}else{if(j===3){showmsg(false,e,"部分信息同步失败")}}e.removeAttr("disabled").css("background-color","#D6EEF6");if(k.msg.app_description){$("#app_description_"+c).val(k.msg.app_description)}if(k.msg.app_version){$("#app_version_"+c).val(k.msg.app_version)}if(k.msg.app_size){$("#app_size_"+c).val(k.msg.app_size)}if(k.msg.app_score){$("#app_score_"+c).text(k.msg.app_score)}if(k.msg.app_pic1){$("#app_pic1_"+c).attr("src",k.msg.app_pic1);$("#wpic1_"+c).attr("data-default",k.msg.app_pic1)}if(k.msg.app_pic2){$("#app_pic2_"+c).attr("src",k.msg.app_pic2);$("#wpic2_"+c).attr("data-default",k.msg.app_pic2)}if(k.msg.app_pic3){$("#app_pic3_"+c).attr("src",k.msg.app_pic3);$("#wpic3_"+c).attr("data-default",k.msg.app_pic3)}if(k.msg.app_pic4){$("#app_pic4_"+c).attr("src",k.msg.app_pic4);$("#wpic4_"+c).attr("data-default",k.msg.app_pic4)}if(k.msg.app_pic5){$("#app_pic5_"+c).attr("src",k.msg.app_pic5);$("#wpic5_"+c).attr("data-default",k.msg.app_pic5)}}else{if(j===1){showmsg(false,e,"填写Google Play地址才可同步信息");e.removeAttr("disabled").css("background-color","#D6EEF6");return}else{showmsg(false,e,"信息同步失败，请重试或手动填写");e.removeAttr("disabled").css("background-color","#D6EEF6");return}}},error:function(){showmsg(false,e,"信息同步失败，请重试");e.removeAttr("disabled").css("background-color","#D6EEF6");return}})});(function(){var f=$("#app_apk_uploader"),h=$("input[name='app_apk']"),i=$(".form_button_upload"),d=$(".form_element_uploaded_name"),g=$(".form_element_uploaded"),e=$("#app_size_2"),c=function(j){h.val(j.filekey);e.val((j.filesize/1024/1024).toFixed(2));i.addClass("none");g.removeClass("none").find(".form_element_uploaded_name").html(j.filename);d.html('<a href="http://app.t.qq.com/download.php?key='+j.filekey+"&name="+global_obj.data.app.app_id+'.apk" target="_blank" title="点击下载">'+global_obj.data.app.app_id+".apk</a>");showmsg(true,h)},b=function(){g.addClass("none");i.removeClass("none");h.val("").removeAttr("data-default");showmsg(false,h,"请上传apk安装文件")};f.bind("click",function(){var j;loginWin.show({text:'<iframe src="/html/upload.html" width="400" height="140" scrollong=no frameborder=0></iframe>',width:400,height:180,title:"文件上传"});j=loginWin.win.find("iframe")[0];j.callback=function(k){$("#app_downurl_2").val(k.data.filekey);loginWin.close();if(k.ret===0){c(k.data)}};j.errorcallback=function(){b()}});g.find(".form_element_uploaded_del").bind("click",b)})()});