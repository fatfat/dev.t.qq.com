var common={getMsgByRet:function(a){return{"-201":"对不起，请求参数错误！","-202":"请求被拒绝，请稍后再试！","-400":'登录信息已丢失，请 <a href="javascript:;" onclick="common.showLoginWin()">重新登录</a> ！',"-401":'您还未注册开发者！<a href="/developer/add">点击此处注册成为开发者</a>',"-402":'你的电子邮箱尚未通过验证，不能完成此操作！<a href="/developer/checkemail/">查看详情</a>'}[a]||false},setCookie:function(i,a,d){if(typeof a!="undefined"){d=d||{};if(a===null){a="";d.expires=-1}var j="";if(d.expires&&(typeof d.expires=="number"||d.expires.toUTCString)){var c;if(typeof d.expires=="number"){c=new Date();c.setTime(c.getTime()+(d.expires*24*60*60*1000))}else{c=d.expires}j="; expires="+c.toUTCString()}var f=d.path?"; path="+(d.path):"";var b=d.domain?"; domain="+(d.domain):"";var h=d.secure?"; secure":"";document.cookie=[i,"=",encodeURIComponent(a),j,f,b,h].join("")}else{var k=null;if(document.cookie&&document.cookie!=""){var e=document.cookie.split(";");for(var g=0;g<e.length;g++){var l=jQuery.trim(e[g]);if(l.substring(0,i.length+1)==(i+"=")){k=decodeURIComponent(l.substring(i.length+1));break}}}return k}},store:(function(){var g={},d=window,a=d.document,c="localStorage",e="globalStorage",f;g.set=function(h,i){};g.get=function(h){};g.remove=function(h){};g.clear=function(){};g.getItems=function(){};if(c in d&&d[c]){f=d[c];g.set=function(i,h){f.setItem(i,h)};g.get=function(h){return f.getItem(h)};g.remove=function(h){f.removeItem(h)};g.clear=function(){f.clear()};g.getItems=function(){var i={};for(var h in f){i[h]=f[h]}return i}}else{if(e in d&&d[e]){f=d[e][d.location.hostname];g.set=function(i,h){f[i]=h};g.get=function(h){return f[h]&&f[h].value};g.remove=function(h){delete f[h]};g.clear=function(){for(var h in f){delete f[h]}};g.getItems=function(){var i={};for(var h in f){i[h]=f[h]}return i}}else{if(a.documentElement.addBehavior){function b(){if(f){return f}f=a.body.appendChild(a.createElement("div"));f.style.display="none";f.addBehavior("#default#userData");f.load(c);return f}g.set=function(k,h){var j=b(),i=j.getAttribute("sessionKey")||"";j.setAttribute(k,h);if(i.search(new RegExp("\\b"+k+"\\b"))===-1){j.setAttribute("sessionKey",i.split("|").concat(k).join("|"))}j.save(c)};g.get=function(i){var h=b();return h.getAttribute(i)};g.remove=function(i){var h=b();h.removeAttribute(i);h.save(c)};g.clear=function(){var k=b();var i=k.XMLDocument.documentElement.attributes;k.load(c);for(var j=0,h;h=i[j];j++){k.removeAttribute(h.name)}k.save(c)}}}}return g})(),showLoginWin:function(a){loginWin.close();setTimeout(function(){loginWin.showBox(500,300,a||encodeURIComponent(location.href),"用户登录")},100);return false},checkuserLogin:function(a){hdlogin=window.hdlogin||false;a=a||encodeURIComponent(location.href);if(hdlogin){return true}else{common.showLoginWin(a)}return false},loginOut:function(){common.setCookie("uin",null,{domain:"qq.com",path:"/"});common.setCookie("skey",null,{domain:"qq.com",path:"/"});common.setCookie("luin",null,{domain:"qq.com",path:"/"});common.setCookie("lskey",null,{domain:"qq.com",path:"/"});location.reload();return false}};var moduleObj={};(function(a){a.fn.moduleBox=function(b){b=b||{};var d={width:b.width||450,height:b.height||320,title:b.title||"提示信息",text:b.text||"",closeBtn:b.closeBtn||""},c={};c.initModuleBox=function(){var e=a('<div class="modulebox" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:99999;text-align:left;_ position:absolute;_ top:expression(eval(document.documentElement.scrollTop)); _ height:expression(eval(document.documentElement.clientHeight));display:none;"><iframe width="100%" height="100%" frameborder="0" style="opacity:0;filter:alpha(opacity=0);z-index:1;position:absolute;top:0;left:0;"></iframe><div style="position:absolute;top:0;left:0;z-index:2;background:#000;width:100%;height:100%;opacity:0.2;filter:alpha(opacity=10);"></div>	<div class="modulebox_win" style="position:absolute;z-index:3;top:50%;left:50%;margin:'+(-d.height/2)+"px 0 0 "+(-d.width/2)+"px;width:"+d.width+"px;height:"+d.height+'px;">		<a href="javascript:;" class="modulebox_close closewin" title="关闭"></a>		<h2 class="modulebox_title" style="margin:0;padding:0;">'+d.title+'</h2>		<div class="modulebox_content" style="height:'+(d.height-41)+'px">'+d.text+"</div>	</div></div>").appendTo(a("body"));e.find(".closewin").bind("click",function(){e.hide()});return{working:false,waiting:[],titlebar:e.find(".modulebox_title"),win:e.find(".modulebox_win"),contentarea:e.find(".modulebox_content"),closebtn:e.find(".modulebox_close"),close:function(f){this.working=false;this.contentarea.html("");e.hide();(f||function(){})();if(this.waiting.length>0){var h=this,g=h.waiting.shift();setTimeout(function(){h[g._show||"show"].call(h,g,f)},100)}},show:function(f){if(this.working){this.waiting.push(f);return}if(f){if(f.title){this.titlebar.html(f.title)}if(f.text){this.contentarea.html(f.text)}if(f.width){this.win.css({width:f.width,"margin-left":-f.width/2})}if(f.height){this.win.css({height:f.height,"margin-top":-f.height/2});this.contentarea.css({height:f.height-41})}}if(!e.is(":visible")){e.show();this.working=true}}}};return c.initModuleBox()}})(jQuery);this.init=function(){$("#logoutBtn").bind("click",common.loginOut);$("#loginBtn,#loginBtn2").click(function(){common.showLoginWin();return false});$("#developmentbtn").click(function(){return(!!checkuserLogin(encodeURIComponent("http://"+location.host.replace(/\bwiki\b\./,"dev.")+"/development/")))});$("#loginBtn_body").click(function(){loginWin.showBox(335,380);return false});$(".boxbg").click(function(){loginWin.hideBox()});$(".login_div_header").find(".closeBtn").click(function(){loginWin.hideBox()});window.loginWin=$.fn.moduleBox({width:500,height:400,title:"",text:""});window.loginWin.closebtn.bind("click",function(){loginWin.close.call(loginWin)});window.loginWin.showBox=function(c,b,a,d){a="http://ui.ptlogin2.qq.com/cgi-bin/login?appid=46000101&s_url="+a+"&f_url=loginerroralert&style=0&link_target=blank&target=blank&hide_title_bar=1&dummy=1&bgcolor=ffffff";this.show({width:c,height:b,title:d||"对不起，您还未登录",text:'<div id="login_div" style="*display:inline;zoom:1;padding-top:20px;width:100%;height:100%;"><iframe src="'+a+'" width="100%" height="100%" frameborder="0" scrolling="no" marginwidth="0" marginheight="0"></iframe></div>'})};window.loginWin.alert=function(a,c){var b={_show:"alert",title:"提示",text:"",width:420,height:150,ok_text:"确定",ok_class:"devSubmit closeBtn"};if(typeof a=="string"){b.text=a}else{if(typeof a=="object"){b.title=a.title||b.title;b.text=a.text||b.text;b.width=a.width||b.width;b.height=a.height||b.height;b.ok_text=a.ok_text||b.ok_text;b.ok_class=a.ok_class||b.ok_class}}(typeof(a&&a._show)==="undefined")&&(b.text="<br/>"+b.text+'<center><input type="button" class="'+b.ok_class+'" value="'+b.ok_text+'"/></center>');loginWin.show.call(loginWin,b);loginWin.contentarea.find(".closeBtn").bind("click",function(){loginWin.close.call(loginWin,c)})};window.loginWin.showImg=function(a,c){var b={_show:"alert",title:"提示",text:"",width:500,height:650};if(typeof a=="string"){b.text=a}else{if(typeof a=="object"){b.title=a.title||b.title;b.text=a.text||b.text;b.width=a.width||b.width;b.height=a.height||b.height}}(typeof(a&&a._show)==="undefined")&&(b.text='<div style="overflow:auto;text-align:center;"><img src=\''+b.text+"' /></div>");loginWin.width=b.width;loginWin.height=b.height;loginWin.show.call(loginWin,b)};window.loginWin.confirm=function(b,e,d){var f={width:420,height:180,text:"",title:"提示",ok_text:"确定",cancel_text:"取消"},c='<div style="text-align:center;margin:0 20px;">		 		  <div style="text-align:left;display:inline-block;* display:inline;zoom:1;margin:22px auto 14px;word-wrap:break-word;word-break:break-all;">		 			#text#		 		  </div>	 		</div>	 		<div align="center">	 		  	<a href="javascript:;" class="devSubmit sure_btn">#ok_text#</a>	 		  	<a href="javascript:;" class="devCancel close_btn">#cancel_text#</a>	 		</div>',g=loginWin,a=g.contentarea;if(typeof(b)==="string"){b=c.replace("##",b);f=$.extend(f,{text:b})}else{if(typeof(b)==="object"){b.text=c.replace(/#(\S+)?#/g,function(){return b[arguments[1]]||("#"+arguments[1]+"#")});$.extend(f,b)}}this.show(f);a.find(".sure_btn").bind("click",function(){g.close();e&&e()});a.find(".close_btn").bind("click",function(){g.close();d&&d()});this.closebtn.unbind("click").bind("click",function(){window.location.reload()})}};this.util=this.util||{};util.setLoginInfo=function(){$.ajax({dataType:"json",type:"post",url:"/pipes/interfaceserver",data:{action:"get_login_info"},success:function(a){if(a.ret!=0&&a.msg){loginWin.alert("<center>"+msg+"</center>");return}var b=['<%if (hdlogin != "false" ) {%>','<div class="menu">','<a class="login_name" href="javascript:;" title="<%=nick?nick:uin%>"><%=nick?nick:uin%><em></em></a>','<i class="nav_arrow"></i>',"</div>",'<ul class="childMenu userNav_sub">','<li class="sub_item"><a class="sub_item_link sub_active" href="/development/developer/">编辑开发者信息</a></li>','<li class="sub_item"><a class="sub_item_link" href="javascript:;" id="logoutBtn">退出</a></li>',"</ul>","<%} else {%>",'<a title="点击此处登录" class="login_name" href="javascript:void(0);" id="loginBtn" hidefocus>登录</a>',"<%}%>",].join("");$("#login_status").html(tmpl(b,a.data));if(a.data.hdlogin&&a.data.hdlogin!=false&&a.data.hdlogin!="false"){a.data.hdlogin=true;$("#logoutBtn").bind("click",common.loginOut)}else{a.data.hdlogin=false;$("#loginBtn").click(function(){common.showLoginWin();return false})}global_obj.data.userInfo.hdlogin=userInfo.hdlogin=hdlogin=a.data.hdlogin}})};var showLoginWin=common.showLoginWin,cookie=common.setCookie,checkuserLogin=common.checkuserLogin,openAppAfterLogin=function(a){return(!!checkuserLogin(a.attr("href")))},ptlogin2_onResize=function(a,b){console.log([a,b].join(","));$(".modulebox_content").removeAttr("style").parent().width(a).css("margin-left",-Math.ceil(a/2)).end().height(b+40).parent().height(b+75);$("#login_div").height(b)};$(function(){$("body").mouseover(function(c){var a=$("#login_status"),b=c.target;if(window.hdlogin&&window.hdlogin!="false"&&window.hdlogin!=false){if($.contains(a[0],b)||a[0]===b){a.addClass("menuContainer")}else{a.removeClass("menuContainer")}}})});