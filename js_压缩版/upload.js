var common={config:{port:"80",userdata:(function(){return +(Math.round(Math.random()*10000).toString()+new Date().getMilliseconds())})()},cookie:{get:function(b){var a=document.cookie.match(new RegExp("\\b"+b+"\\b=([^=;s]*)?","g"));return a&&a[1]}},genFileId:function(){return +(Math.round(Math.random()*10000).toString()+new Date().getMilliseconds())},initPlugin:function(){var a=function(){var c;if(_isSupportActiveX()){try{new ActiveXObject("TXFTNActiveX.FTNUpload")}catch(b){return false}}else{c=navigator.plugins["Tencent FTN plug-in"];if(!c||_isFF()&&(c[0].type!="application/txftn"&&c[0].type!="application/txftn-webkit")||!_isFF()&&c[0].type!="application/txftn-webkit"){return false}_pluginType=c[0].type}return true};if(_plugin){return 0}if(!a()){return 1}if(_isSupportActiveX()){_plugin=new ActiveXObject("TXFTNActiveX.FTNUpload")}else{_plugin=document.createElement("embed");_plugin.width=0;_plugin.height=0;_plugin.type=_pluginType;_plugin=document.body.appendChild(_plugin)}_plugin.OnEvent=common.OnEventHandler;_plugin.RetryTime=20;_plugin.BlockSize=128*1024;_plugin.TimeOut=90*1000;_plugin.BreakSize=64*1024;_plugin.MaxConcurrentUploadNum=3;return 0},OnEventHandler:function(b){if(_plugin.UserDatabyLocalID(b.LocalID)==9226){return}var a=[function(){},function(){var c=document.getElementById("tempscript");common.config.Path=b.Path;common.config.FileSize=b.FileSize;common.config.Processed=b.Processed;common.config.userdata=_plugin.UserDatabyLocalID(b.LocalID);common.config.sha=b.SHA;common.config.md5=b.Md5;common.config.fileSize=b.FileSize;if(b.FileSize>104857600){common.setMsg("文件大小请控制在100M以内",2);return false}if(!c){c=document.createElement("script");c.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(c)}c.src="http://open.t.qq.com/api/file/upload_file?filesize="+b.FileSize+"&shahash="+b.SHA+"&md5="+b.Md5+"&filename="+b.Path+"&createtime=1363868150&modifytime=1363868150&format=common.uploadFile&t="+(+new Date());common.setMsg("成功获取签名信息，开始创建文件...",0)},function(){common.setMsg("正在获取文件签名信息...",0);common.setUploadProgress(b.Processed/b.FileSize)},function(){if(b.ErrorCode!==0||b.Step!==0){common.setMsg("上传失败",2);frameElement.callback({ret:1,path:""})}else{common.setMsg('上传成功,<a href="http://app.t.qq.com/download.php?key='+(common.config.filekey.slice(1))+"&name="+encodeURIComponent(common.config.filename)+'" target="_blank">点击下载</a>',1);common.setUploadProgress(1);if(frameElement.callback){setTimeout(function(){frameElement.callback({ret:0,msg:"上传成功",data:{filename:common.config.filename,filekey:common.config.filekey.slice(1),filesize:common.config.fileSize}})},100)}}},function(){common.setMsg("正在上传文件...",0);common.setUploadProgress(b.Processed/b.FileSize)},function(){}][+b.EventType];a()},selectFile:function(){var a;if(_plugin){a=_plugin.SelectFiles(window).split(/[\s\r\n]+/g);return a[0]}else{common.setMsg('您需要安装上传控件才能进行上传，点击此处 <a href="http://mail.qq.com/cgi-bin/readtemplate?t=browser_addon&check=false&returnto='+encodeURIComponent(top.location.href)+'" onclick="return common.resizeFrameElement(960,450);">安装上传控件</a>',2);return false}},getFileInfo:function(){var a;common.config.file=common.selectFile();if(common.config.file){a=common.config.file.match(/([^\\]+$)/);if(/\.apk$/.test(common.config.file)===false){var c=document.documentElement||document.body;common.setMsg("仅支持apk安装包！你的安装包文件路径为：<br/>"+common.config.file+'<br/><span style="color:green;">注：安装包路径中不能含有空格！</span>',2);common.resizeFrameElement(c.scrollWidth,c.scrollHeight);return false}common.config.filename=a&&a[1];common.setUploadProgress(0);$("upload_txt").value=common.config.file;$("progress").className="";var b=_plugin.FileSign(common.config.file,855)}},uploadFile:function(b){if(b.ret===0){b.path=(function(d){var c=d.split("/");c[1]=c&&c[1]&&c[1].substr(0,36);return c.join("/")})(b.path);common.config.filekey=b.path;var a=_plugin.UploadFile(b.ip,b.port||80,b.checkkey,common.config.sha,b.path,common.config.Path,853);common.setMsg("创建文件成功，开始上传...",0)}else{if(b.errcode===3){common.setMsg("您还没有登录，请先登录",2)}else{common.setMsg("创建文件失败，"+b.msg,2)}}},init:function(){common.getFileInfo()},setUploadProgress:function(b){var e=$("progress"),d=$("progress_bar"),c=$("progress_bar_percent"),a=e.clientWidth;d.style.width=(b*100)+"%";c.innerHTML=Math.ceil(b*100)+"%";if(b>0.06){c.className="start"}else{c.className=""}},setMsg:function(c,b){var a=$("panel");b=b||0;a.className=["","yes","no"][b];a.innerHTML=c},resizeFrameElement:function(a,b){frameElement.width="100%";frameElement.height=b;parent.ptlogin2_onResize(a,b)}};var _plugin=null;function _isSupportActiveX(){return !(typeof ActiveXObject=="undefined")}function _isFF(){return navigator.userAgent.toLowerCase().indexOf("firefox")>=0}function $(b){return document.getElementById(b)}window.onload=function(){var a=common.initPlugin();$("upload_btn").onclick=common.init;if(!(window.console&&window.console.log)){var b=document.getElementById("console");window.console={log:function(c){b.value+=c+"\n"},dir:function(c){b.value+=c+"\n"},clear:function(){b.value=""}}}};