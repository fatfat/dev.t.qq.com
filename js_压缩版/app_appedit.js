var OPEN_VALIDATOR;OPEN_VALIDATOR={apptypeName:"应用",working:0,checkip:function(c){var a=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;var b=c.match(a);if(b===null){return"非法的IP地址段！"}else{return true}},isempty:function(){return true},appsupport:function(){return true},appsupportIsEmpty:function(d){var a=d.attr("data-error"),b=d.attr("data-terminal");var c=$("#app_support_list").find("input[name='check_"+b+"']:checked").size();return c>0},tname:function(a){if(a&&!(/^[a-zA-Z][a-zA-Z0-9_\-]{3,19}$/g.test(a))){return"##输入有误"}return true},appweibo:function(a,b){var e=b.attr("data-error");a=a.replace(/\s/g,"");b.val(a);if(a&&!(/^[a-zA-Z][a-zA-Z0-9_\-]{0,19}$/g.test(a))){return e+"输入有误"}var c=b.attr("data-only");if(c){if(c==="true"){return true}else{return"该"+e+"不存在"}}else{var d=b.attr("data-default");if(d){if(a==d){return true}else{return 1}}else{return 1}}return true},telnum:function(a){if(new RegExp(/^([0-9]|[-])+$/g).test(a)){return true}else{return"##格式错误"}},link:function(a){var c="^((news|telnet|nttp|file|http|ftp|https)://)(([-A-Za-z0-9_]+(\\.[-A-Za-z0-9_]+)*(\\.[-A-Za-z]{2,6}))|([0-9]{1,3}(\\.[0-9]{1,3}){3}))(:[0-9]*)?(/[-A-Za-z0-9_$\\.+!*(),;:@&=?/~#%']*)*";var b=new RegExp(c);if(/["'<>]/g.test(a)){return"##不能含有'\"<>"}else{if(b.test(a)){return true}else{return"##格式错误"}}},appstorelink:function(a){var c="^((https|http)://itunes.apple.com)(:[0-9]*)?(/[-A-Za-z0-9_$\\.+!*(),;:@&=?/~#%']*)*";var b=new RegExp(c);if(/["'<>]/g.test(a)){return"##不能含有'\"<>"}else{if(b.test(a)){return true}else{return"请填写苹果官方市场下载地址"}}},androidlink:function(a){var c="^(https://play.google.com)(:[0-9]*)?(/[-A-Za-z0-9_$\\.+!*(),;:@&=?/~#%']*)*";var b=new RegExp(c);if(a){if(/["'<>]/g.test(a)){return"##不能含有'\"<>"}else{if(b.test(a)){return true}else{return"##格式错误"}}}else{return true}},applink:function(a){if(a){return OPEN_VALIDATOR.link(a)}else{return true}},appapk:function(a){if(a){return true}else{return"请上传##"}},email:function(a){if(new RegExp(/^([a-zA-Z0-9._-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/).test(a)){return true}else{return"##格式错误"}},appname:function(a,c){a=a.replace(/^\s+|\s$/g,"");c.val(a);var b=a.match(/[^A-Za-z0-9（）()\u4e00-\u9fa5]+/g);if(a&&b){return"##不能含有非法字符"+b.join("")}if(a.replace(/[^\x00-\xff]/g,"tx").length<=14){var e=c.attr("data-only");if(e){if(e==="true"){return true}else{var d=c.parent().next().text();if(d!=""){return d}else{return"此##已被注册"}}}else{var f=c.attr("data-default");if(f){if(a==f){return true}else{return 1}}else{return 1}}}else{return"##不能超过7个汉字"}},appnameCheck:function(a,d){var g=d.attr("data-error"),f=d.attr("data-default"),b=d.attr("data-rule"),e={appname:"/pipes/interfaceserver",compname:"/pipes/interfaceserver"},c={appname:{action:"common_query",business_type:"ajax_checkname",appname:a},compname:{action:"common_query",business_type:"ajax_checkcompname",comp_name:encodeURIComponent(a),comp_type:window.comp_type}};c[b]["random"]=+new Date();if(f!=a){showmsg(1,d,"正在验证"+g+"是否重复...");$.ajax({type:"get",dataType:"json",url:e[b],data:c[b],success:function(h){var i=d.attr("data-working")|0;if(h.error==0){d.attr("data-only",true);showmsg(true,d,"");if(i==2){loginWin.close();setTimeout(function(){$("form input[type='submit']").trigger("click")},500)}d.removeAttr("data-working")}else{d.attr("data-only",false);showmsg(false,d,h.msg);d.removeAttr("data-working");if(i==2){loginWin.close();loginWin.alert("<center>"+h.msg+"</center>")}return false}},error:function(){d.attr("data-only","false");d.removeAttr("data-working");setTimeout(function(){showmsg(false,d,"验证失败！请检查网络")},100);return false}});return true}else{d.attr("data-only","true");d.removeAttr("data-working");return true}},appdes:function(a,b){a=$.trim(a);b.val(a);if(a.length>140){return"##不能超过140个汉字"}else{if(a.length<30){return"##不能少于30个汉字"}else{return true}}},wappdes:function(a,b){a=$.trim(a);b.val(a);if(a.length<30){return"##不能少于30个汉字"}else{return true}},apphight:function(a,b){a=$.trim(a);$("#app_hight").val(a);if(new RegExp(/^[1-9][0-9]*$/).test(a)){if(a>1200||a<700){return"##必须在700—1200之间"}else{return true}}else{return"##必须是正整数"}},appname_only:true,companyname:function(a){if(a.length<=40){return true}if(a.length>40){return"##不能超过40个字符"}},comaddress:function(a){if(a.length<=100){return true}if(a.length>100){return"##不能超过100个字符"}},comperson:function(a){if(a.length<=20){return true}if(a.length>20){return"##不能超过20个字符"}},app_class_main:function(a){if(a==-1||a<=0){return"请选择分类"}return true},app_class_child:function(a){var b=$("input[name='app_type']").val();if(b!=4){return true}if(a==-1||a<=0){return"请选择分类"}return true},appweiboCheck:function(a,d){var g=d.attr("data-error"),f=d.attr("data-default"),b=d.attr("data-rule"),e="/pipes/interfaceserver",c={name:a,action:"common_query",business_type:"ajax_checkwb"};if(f!=a){showmsg(1,d,"正在验证"+g);$.ajax({type:"get",dataType:"json",url:e,data:c,success:function(i){var k=d.attr("data-working")|0,h=+i.ret,j=common.getMsgByRet(h);if(j){d.attr("data-only",false);showmsg(false,d,j);d.removeAttr("data-working");return}if(h===0){d.attr("data-only",true);showmsg(true,d,"");if(k==2){setTimeout(function(){$("form input[type='submit']").trigger("click")},500)}d.removeAttr("data-working")}else{d.attr("data-only",false);d.attr("error-flag",0);showmsg(false,d,"该"+g+"不存在");d.removeAttr("data-working");if(k==2){loginWin.alert("<center>该"+g+"不存在</center>")}return false}},error:function(){d.attr("data-only","false");setTimeout(function(){showmsg(false,d,"验证失败！请检查网络")},100);return false}});return true}else{d.attr("data-only","true");d.removeAttr("data-working");return true}},installSize:function(a,b){a=$.trim(a);b.val(a);if(new RegExp(/^[\d]+\.?[\d]*([Mm][Bb]?)?$/).test(a)){return true}else{return"##格式不正确"}}};OPEN_VALIDATOR.apptypeName=/iweibo/.test(location.pathname)?"组件":(/platform/.test(location.pathname)?"平台":"应用");function getlen(c){var a=0;for(var b=0;b<c.length;b++){if(c.charCodeAt(b)>255){a+=2}else{a++}}return a}function showmsg(c,e,g){var b,f=e.parent(),a=e.parent(".form_input"),d=e.parent(".form_element");if(!c){b='<span class="tip tip_err"><span class="tip_icon"></span>'+g+"</span>"}else{if(true===c){b='<span class="tip tip_ok"><span class="tip_icon"></span></span>'}else{if(1===c){b='<span class="tip tip_waiting"><span class="tip_icon"></span>'+g+"</span>"}else{if(2===c){b='<span class="tip">'+g+"</span>"}}}}if(f.hasClass("form_input")||f.hasClass("form_element")){f.parent().find(".tip").remove();f.after(b);f.parent().find(".inputdes").first().hide()}else{if(f.hasClass("form_button_upload")){f.parent().find(".tip").remove();f.parent().append(b);f.parent().find(".inputdes").first().hide()}else{f.find(".tip").remove();f.append(b)}}}function formSubmit(){if($(".errorTip").length>0){loginWin.show({title:"更新"+OPEN_VALIDATOR.apptypeName+"信息",width:410,height:185,text:'<center><br/><label class="icon_alert"></label> &nbsp;表单中有错误，请修改后再提交 <br/><input type="button" class="devSubmit closeBtn" value="返回修改"/></center>'});loginWin.contentarea.find(".closeBtn").bind("click",function(){loginWin.close()})}else{loginWin.show({title:"更新"+OPEN_VALIDATOR.apptypeName+"信息",width:410,height:120,text:"<div style='text-align:center;line-height:59px;'>数据提交中，请勿操作或关闭浏览器窗口</div>"})}}$(function(){$('<div class="tooltip" id="tooltip"><div class="toolangle"><span class="a1">◆</span><span class="a2">◆</span></div><div class="tooltext"></div></div>').appendTo($("body"));window.tooltip={timer:null,show:function(d,b,a){var c=b.offset();$("#tooltip").show().css({left:c.left,top:c.top+b.height()}).find(".tooltext").html(d);b.get(0).scrollIntoView(true);clearTimeout(tooltip.timer);if(a){tooltip.timer=setTimeout(function(){$("#tooltip").fadeOut()},a)}}};$("input[type='file']").change(function(){var k=this.files&&this.files[0],e=$(this),b=$(this).parent().find("img")[0],d=$(this).parent().find("img"),l=new Image(),g="",h=e.attr("_size")||500,f=e.hasClass("png_jpg")?2:1,o=f==2?new RegExp(/\.(png|jpeg|jpg)$/i):new RegExp(/\.(png)$/i),c=f==2?new RegExp(/^image\/(png|jpeg)$/i):new RegExp(/^image\/(png)$/i),n=f==2?"jpg/png":"png",a=function(){setTimeout(function(){d.removeAttr("src").attr("src","http://mat1.gtimg.com/app/opent/images/websites/0.gif");e.val("")},100)},i=function(q){loginWin.alert({text:'<div style="margin:0 0 0 30px;">由于您的浏览器安全限制，'+q+'<br/>请将本站( <span style="color:red;font-weight:bold;">'+location.href.slice(0,location.href.indexOf(location.pathname)+1)+'</span> )添加到受信任的站点列表中 <br/>点击此处了解 <a href="http://open.t.qq.com/bbs/forum.php?mod=viewthread&tid=21271" target="_blank">如何将本站添加到受信任的站点列表中？</a></div><div style="color:#090;margin:0 30px;">您也可以使用非IE内核浏览器，如chrome、firefox（Safari暂不支持）</div>',width:460,height:200});a()},p=function(){b.src="http://mat1.gtimg.com/app/opent/images/websites/0.gif";var q=setTimeout(function(){if(+(l.width||"")===0||+(l.height||"")===0){i("无法获取图片大小");e.attr("data-error",g);return}},200);l.onload=function(){if(this.complete){return false}if(o.test(l.src)==false){g="你上传的图片不是有效的"+n+"格式图片";loginWin.alert("<center>"+g+"</center>");e.attr("data-error",g);a();return}else{if(l.fileSize/1024>h){g="文件大小不能超过"+h+"K，请重新选择";loginWin.alert("<center>"+g+"</center>");e.attr("data-error",g);a();return}else{if(d.attr("_width")&&d.attr("_width")){if(+(l.width||"")===0||+(l.height||"")===0){i("无法获取图片大小");e.attr("data-error",g);a();return}else{if(l.width!=d.attr("_width")||l.height!=d.attr("_height")){g="你上传的图片尺寸"+l.width+"×"+l.height+"不符合要求，请选择一张"+d.attr("_width")+"×"+d.attr("_height")+"大小的"+n+"图片";e.attr("data-error",g);g+='<div style="border-top:1px dashed #ccc;margin-top:5px;padding-top:5px;"><strong>如果你的图片尺寸符合要求但仍然看到该提示，你可以：</strong><br/>1、如果你的浏览器是双核浏览器，可以切换到极速模式重新上传<br/>2、如果你的浏览器不是双核浏览器，可以使用其它浏览器，如chrome或firefox</div>';loginWin.alert({text:'<div style="margin:0 25px;">'+g+"</center>",width:500,height:215});e.attr("data-error",g);a();return}}}}}b.src=l.src;e.removeAttr("data-error");l.onload=null};l.onerror=function(){g="读取图片失败，浏览器不支持直接读取图片";i("加载图片失败");e.attr("data-error",g);l.onerror=null;a();return};l.src=e[0].value;return},j=function(){g="你的浏览器不支持fileReader，无法预览图片<br/>建议使用firefox或chrome浏览器或升级您当前的浏览器至最新版本";loginWin.alert({text:"<center>"+g+"</center>",height:170});e.attr("data-error",g);a();return},m=function(){var r=new FileReader(),q=function(u){return function(v){for(var w in u){u[w].src=v.target.result}}},t=false;r.onload=q([b,l]);r.readAsDataURL(k);q([b]);if(d.attr("_width")&&d.attr("_width")){(function(){var u=arguments.callee,v=arguments[0];if((((l.width||l.height)|0)==0)&&(v<10)){setTimeout(function(){u(++v)},100);return}if((l.width!=d.attr("_width")||l.height!=d.attr("_height"))&&!t){g="你上传的图片尺寸"+l.width+"×"+l.height+"不符合要求<br/>请选择一张"+d.attr("_width")+"×"+d.attr("_height")+"大小的"+n+"图片";b.src="http://mat1.gtimg.com/app/opent/images/websites/0.gif";loginWin.alert({text:"<center>"+g+"</center>",height:160});e.attr("data-error",g);a();return}if(!t){e.removeAttr("data-error",g)}})(0)}if(c.test(k.type)&&(k.fileSize||k.size)/1024<=h){}else{if(c.test(k.type)==false){g="你上传的图片不是有效的"+n+"格式图片";t=true;loginWin.alert("<center>"+g+"</center>");e.attr("data-error",g);a();return false}else{if((k.fileSize||k.size)/1024>h){g="文件大小不能超过"+h+"K，请重新选择";t=true;loginWin.alert("<center>"+g+"</center>");e.attr("data-error",g);a();return false}else{e.removeAttr("data-error");return true}}}};if(window.FileReader){return m()}else{if(document.all){return p()}else{return j()}}})});var need_post=false;$(function(){function g(){var h=[];$("input[name='check_app_os']:checked").each(function(){h.push($(this).val())});$("input[name='app_os']").val(h.join("|"));return h}function c(){var h=[];$("input[name='check_app_phone']:checked").each(function(){h.push($(this).val())});$("input[name='app_phone']").val(h.join("|"));return h}function f(){var h=[];$("input[name='check_app_pad']:checked").each(function(){h.push($(this).val())});$("input[name='app_pad']").val(h.join("|"));return h}$("input[name='check_app_os'],input[name='check_app_phone'],input[name='check_app_pad']").change(function(){var i=$(this).attr("name").replace("check_app_","").toLowerCase();var h="";switch(i){case"os":h=g();$("input[name='app_phone']").val("");$("input[name='app_pad']").val("");break;case"phone":h=c();$("input[name='app_os']").val("");$("input[name='app_pad']").val("");break;case"pad":h=f();$("input[name='app_os']").val("");$("input[name='app_phone']").val("");break}$("#app_support").trigger("blur")});$("input#app_name,input#app_url,input#app_down_url,input#app_support,textarea#app_description,input[type=checkbox],input#app_weibo,select#app_class_main,select#app_class_child").change(function(){need_post=1});$("form input[data-rule='appweibo']").change(function(){var i=$(this),h=i.attr("data-rule"),j=i.val();if(h=="appweibo"){if(/^[a-zA-Z][a-zA-Z0-9_\-]{0,19}$/g.test(j)){i.removeAttr("data-only");i.removeAttr("error-flag");i.attr("data-working",1);OPEN_VALIDATOR.appweiboCheck(j,i)}}});$("form input[type='text'],form textarea").blur(function(){var m,l,h,j,i;m=$(this);l=m.val();h=m.attr("data-rule");j=m.attr("data-error");if((/^link|applink$/.test(h))&&l.length>0&&l.search(/http[s]?:\/\//)==-1){l="http://"+l;m.val(l)}if(OPEN_VALIDATOR.hasOwnProperty(h)&&h){if((!$.trim(l)&&h!="tname"&&h!="applink"&&h!="androidlink")||(l=="请选择"&&h=="appsupport")){j+="不能为空";i=false}else{var k=OPEN_VALIDATOR[h](l,m);if(k&&h=="appsupport"){i=OPEN_VALIDATOR.appsupportIsEmpty($(this));j+="不能为空"}else{if(k==undefined){i=false;j=""}else{if(k===true){i=true}else{if(k===1){return}else{i=false;j=k.replace(/##/g,j)}}}}}showmsg(i,m,j)}});$("form input[type='checkbox']").click(function(){var i=$(this).attr("name"),h=$(this).attr("data-rule");if(h=="isempty"){if($(this).parent().find("input[type='checkbox']:checked").size()==0){showmsg(false,$(this),"请至少选择一项")}else{showmsg(true,$(this),"")}}});$("form input[type='submit']").click(function(){var o=this.form,x=$(o).find("input[data-working]");if(x.size()>0){x.attr("data-working",2);return false}var k=$.trim($(this).attr("data-rule")),v=+$("#app_platform").val();if(k=="formauto"){if($(o).hasClass("wirelessappform")&&v===0){loginWin.alert("<center>请至少选择一个平台</center>");return false}if(global_obj.data.app.app_type==3&&$("input[name='check_app_os']:checked").size()==0){loginWin.alert("<center>请至少选择一个应用平台</center>");return false}var w=this.form,l,h,u,z,r=true,t="",p=true;if(!OPEN_VALIDATOR.appname_only){h="此"+OPEN_VALIDATOR.apptypeName+"名称已被注册";loginWin.alert("<center>"+h+"</center>");return false}$("form input[type='text'],form textarea,select#app_class_main,select#app_class_child,form input[type='file']").each(function(){if($(o).hasClass("wirelessappform")){if((v===1&&$(this).hasClass("android_field"))||(v===2&&$(this).hasClass("iphone_field"))){return}}u=$(this).attr("data-rule");z=$(this).val();h=$(this).attr("data-error");if(OPEN_VALIDATOR.hasOwnProperty(u)&&u){if((!$.trim(z)&&u!="tname"&&u!="applink"&&u!="androidlink")||(z=="请选择"&&u=="appsupport")){h+="不能为空";l=false}else{var A=OPEN_VALIDATOR[u](z,$(this));if(A&&u=="appsupport"){l=OPEN_VALIDATOR.appsupportIsEmpty($(this));h+="不能为空"}else{if(A===true){l=true}else{if(A===1){return}else{l=false;h=A.replace(/##/g,h)}}}}showmsg(l,$(this),h);if(r&&!l){loginWin.alert("<center>"+h+"</center>")}r=r&&l}else{if($(this).hasClass("required")){if((!$(this).val()&&!$(this).attr("data-default").replace("NULL",""))||$(this).attr("data-error")){p=false;str="<center>请上传应用预览图</center>";$(this).prev(".uploadbtn")[0].scrollIntoView(true);if(r){loginWin.alert(str)}tooltip.show(str,$(this).prev(".uploadbtn"),2000);r=r&&p;return false}}else{if($(this).hasClass("file")){if(r&&$(this).attr("data-error")){$(this).attr("disabled","disabled");return false}}}}});if(!r){return r}if($(o).hasClass("wirelessappform")){var q=$("input[name='appplatform']");if($("input[name='appplatform']:checked").length==0){showmsg(false,$("#iphone_pf"),"请至少选择一个平台");loginWin.alert("<center>请至少选择一个平台</center>");return false}if($("input[name='app_apk']").val()==""&&($("#app_platform").val()==2||$("#app_platform").val()==3)){$("#android_pf")[0].scrollIntoView();var m=$("input[name='app_apk']"),j=$(".form_button_upload"),y=$(".form_element_uploaded_name"),n=$(".form_element_uploaded");n.addClass("none");j.removeClass("none");m.val("").removeAttr("data-default");loginWin.alert("<center>请上传apk安装文件</center>");showmsg(false,m,"请上传apk安装文件");return false}}var i=$("input[name='user_agree']").attr("checked");if(i===undefined){if(r){a(w)}else{return false}}else{if(i==true){if(r){a(w)}else{return false}}else{loginWin.alert("<center>您尚未同意《腾讯微博开放平台开发者服务协议》</center>");return false}}}return false});function a(w){var o=+$("input[name='app_type']").val(),h=global_obj.data.app.app_status,j=$("input[name='app_url']"),x=$("input[name='icon4']"),n=false,p=global_obj.data.androidinfo?global_obj.data.androidinfo.app_plat_status:"",m=global_obj.data.iphoneinfo?global_obj.data.iphoneinfo.app_plat_status:"",q="";if(o===1||o===2||o===3){if(h===4||h===5||h===8){if(j.val()!=j.attr("data-default")){q="<center>修改"+j.attr("data-error")+"后需再次提交审核，审核通过后才能生效。<br/>是否提交修改资料审核？</center>";n=true}}}else{if(o===6){var k=$("#wapp_platform").val();if(k==0){if(+h===5&&p!=2&&m!=2){if(j.val()!=j.attr("data-default")||(x.val()!=""&&x.val()!=x.attr("data-default"))){q="<center>修改"+j.attr("data-error")+"或75×75应用图标后需再次提交审核，审核通过后才能生效。<br/>是否提交修改资料审核？</center>";n=true}}}else{if(+h===3&&(p==2||m==2)){var v=null,t=$("input[name='app_platform']").val(),i=$("input[name='app_platform_changed']"),r=0,u=0,y,l;v=t==3?$(".wirelessappform"):(t==2?$("#androidContainer"):$("#iphoneContainer"));v.find("input[type='text'],textarea,input[type='file']").each(function(){y=$(this).val();l=$(this).attr("data-default");if((!$(this).hasClass("file")&&y!=l)||($(this).hasClass("file")&&y!=""&&y!=l)){if($(this).hasClass("iphone_field")){r=1}else{if($(this).hasClass("android_field")){u=1}}if((p==2&&m==2)||(p==2&&m!=2&&$(this).hasClass("android_field"))||(p!=2&&m==2&&$(this).hasClass("iphone_field"))){q="<center>修改平台信息后需再次提交审核，审核通过后才能生效。<br/>是否提交修改资料审核？</center>";n=true}return}});if(r&&u){i.val(3)}else{if(r){i.val(1)}else{if(u){i.val(2)}}}}}}}if(n){loginWin.confirm({text:q,width:440,ok_text:"确定",cancel_text:"取消"},function(){d(w)},function(){loginWin.close()});return false}d(w)}function d(h){if($(h).hasClass("wirelessappform")){var i=+$("#app_platform").val();if(i===1){$(".android_field").each(function(){$(this).val("")})}else{if(i==2){$(".iphone_field").each(function(){$(this).val("")})}}}h.submit();formSubmit()}$("form input[data-rule='appname']").change(function(){var i=$(this),h=i.attr("data-rule"),j=i.val().replace(/\s/g,"");if(/^[A-Za-z0-9（）()\u4e00-\u9fa5]{1,14}$/.test(j)&&j.replace(/^\s+|\s+$/g,"").replace(/[^\x00-\xff]/g,"TX").length<=14){i.removeAttr("data-only");i.attr("data-working",1);OPEN_VALIDATOR.appnameCheck(j,i)}else{i.removeAttr("data-only")}});$("input[data-rule='link']").keydown(function(h){if(h.keyCode==13){return false}});$("form").keydown(function(h){if(h.keyCode==13){$(this).find("input[type='submit']").trigger("click");return false}});$("form input[type='reset']").click(function(){$(".form_input").next(".errorTip").remove();$(".form_input").next(".currectTip").remove()});var e=$("input[name='app_phone'],input[name='app_pad'],input[name='app_os']").filter("[value ^='']");if(e.size()===0){$("input[name='app_phone']").val("Android");e=$("input[name='app_phone']")}e.each(function(h){var l=$(this).attr("name"),k=$(this).val(),j=$("#app_support").attr("data-terminal")||0;if(k||0){$("#app_support").val($(this).parent("li").find(".form_select_options").find("li:eq("+h+")").text());$("#app_support").attr("data-terminal",l);$("#app_support_list").show();$("#app_support_list").find("input[value='"+k+"']").parent().show().siblings("dd").hide();s=k.split("|");for(var i in s){$("input[name='check_"+l+"']").filter("[value='"+s[i]+"']").attr("checked","checked")}return false}else{$("#app_support").val("请选择").removeAttr("data-terminal")}});$(".tip").remove();var b=function(m){var k=$("#app_online_url").parent(),j=k.find(".form_select_icon"),h=k.find(".form_select_options"),i=k.find("input"),l=0;var n=function(o){var r=[];if(o.length){for(var q=0,p=o.length;q<p;q++){r.push("<li>http://"+o[q]+"</li>")}r.push("<li _index='"+q+"'>手动填写</li>")}else{r[0]='<div class="gray">&nbsp;未申请托管地址，<a href="javascript:;" onclick="$(\'#apphost_btn\').trigger(\'click\');return false;">现在去申请</a></div>'}return r.join("")}(m);if(m.length){i.attr("data-rule","link").attr("readonly",true)}else{k.prev(".form_label").find("em").remove()}h.html(n).find("li").mouseover(function(){$(this).parent().find("li").removeClass("active");$(this).addClass("active")}).click(function(o){if($(this).attr("_index")){i.val("").removeAttr("readonly")}else{i.val($(this).html()).attr("readonly",true)}if(typeof(o.button)!="undefined"){i.trigger("blur")}h.hide()}).filter(":eq(0)").addClass("active");i.attr("readonly",true).attr("autoComplete","off").focus(function(){if(i.attr("readonly")){h.show()}}).bind("keydown",function(r){var o=h.find("li.active"),p=o.index();l=h.find("li").size();if(r.keyCode===9){return true}if(!h.is(":visible")&&i.attr("readonly")){$(this).trigger("focus");return false}switch(r.keyCode){case 40:if(p+1<l){var q=h.find("li:eq("+(++p)+")");q.trigger("mouseover");if(q[0].offsetTop-h[0].scrollTop>=h.height()){h[0].scrollTop+=q.height()}}break;case 38:if(p>0){var q=h.find("li:eq("+(--p)+")");q.trigger("mouseover");if(q[0].offsetTop<h[0].scrollTop){h[0].scrollTop-=q.height()}}break;case 13:if(i.attr("readonly")){o.trigger("click")}h.hide();break;default:return true}return false}).bind("click",function(){if(!h.is(":visible")&&i.attr("readonly")){h.show()}});j.click(function(){if(!i.attr("disabled")){h.show()}});$("body").bind("click",function(o){if($.contains(k[0],o.target)){return}if(h.is(":visible")){h.hide()}})};if(+$("input[name='app_hosting']:checked").val()===1){if(window.app_status&&(+app_status===2)){$("#app_online_url").attr("readonly",true);$("#app_online_url").parent().prev(".form_label").find("em").remove()}else{$.ajax({dataType:"json",type:"post",url:"/pipes/interfaceserver",data:{action:"common_query",uin:global_obj.data.userInfo.hdlogin,appid:global_obj.data.app.app_id,business_type:"ajax_getappsitelist"},success:function(i){var h=+i.ret,j=common.getMsgByRet(h);if(j){loginWin.alert("<center>"+j+"</center>");return}b(i.data||[])}})}}});$("#app_class_child").change(function(){var b=$("#app_class_child");var a=b.val();if(a!=-1){showmsg(true,b,"")}else{showmsg(false,$("#app_class_child"),"应用分类不能为空")}});$("#app_class_main").change(function(){var b=$("#app_class_child");var a=$("#app_class_main").val();if(a!=-1){$.ajax({dataType:"json",type:"get",url:"/pipes/interfaceserver",data:{action:"common_query",business_type:"getapptype",cid:a},success:function(d){if(d!=null){var c=+d.ret,e=common.getMsgByRet(c);if(e){loginWin.alert("<center>"+e+"</center>");return}}showmsg(true,$("#app_class_main"),"");$.each(b,function(){$(this).children().remove()});$.each(d,function(f,g){b.append("<option value="+g.cid+">"+g.cname+"</option>")});b.css("display","inline-block")}})}else{$.each(b,function(){$(this).children().remove()});b.css("display","none");showmsg(false,$("#app_class_main"),"应用分类不能为空")}});var submitCallback=function(c){var b=+(c.code||c.error),d=common.getMsgByRet(b);loginWin.close();if(d){loginWin.alert("<center>"+d+"</center>");return}if(b==0){if(loginWin){loginWin.show({title:"更新"+OPEN_VALIDATOR.apptypeName+"信息",width:410,height:125,text:'<center><br/><label class="icon_ok"></label> &nbsp; '+OPEN_VALIDATOR.apptypeName+"信息更新成功<br/></center>"});setTimeout(function(){window.location.href=window.location.href},2000)}}else{var a="";if(b>100&&b<200){a="图片不合法"}else{if(b>200&&b<300){a="参数非法"}else{a="未知原因"}}if(loginWin){loginWin.show({title:"更新"+OPEN_VALIDATOR.apptypeName+"信息",width:410,height:185,text:'<center><br/><label class="icon_alert"></label> &nbsp; '+OPEN_VALIDATOR.apptypeName+"信息更新失败，原因&nbsp;<strong>"+a+'</strong><br/><input type="button" class="devSubmit closeBtn" value="确定"/></center>'});loginWin.contentarea.find(".closeBtn").bind("click",function(){loginWin.close()})}}};