var OPEN_VALIDATOR;OPEN_VALIDATOR={apptypeName:"应用",working:0,isempty:function(){return true},link:function(a){var c="^((news|telnet|nttp|file|http|ftp|https)://)(([-A-Za-z0-9_]+(\\.[-A-Za-z0-9_]+)*(\\.[-A-Za-z]{2,6}))|([0-9]{1,3}(\\.[0-9]{1,3}){3}))(:[0-9]*)?(/[-A-Za-z0-9_$\\.+!*(),;:@&=?/~#%']*)*";var b=new RegExp(c);if(/["'<>]/g.test(a)){return"##不能含有'\"<>"}else{if(b.test(a)){return true}else{return"##格式错误"}}},appstorelink:function(a){var c="^((https|http)://itunes.apple.com)(:[0-9]*)?(/[-A-Za-z0-9_$\\.+!*(),;:@&=?/~#%']*)*";var b=new RegExp(c);if(/["'<>]/g.test(a)){return"##不能含有'\"<>"}else{if(b.test(a)){return true}else{return"请填写苹果官方市场下载地址"}}},androidlink:function(a){var c="^(https://play.google.com/store)(:[0-9]*)?(/[-A-Za-z0-9_$\\.+!*(),;:@&=?/~#%']*)*";var b=new RegExp(c);if(a){if(/["'<>]/g.test(a)){return"##不能含有'\"<>"}else{if(b.test(a)){return true}else{return"##格式错误"}}}else{return true}},appdes:function(a,b){a=$.trim(a);b.val(a);if(a.length>140){return"##不能超过140个汉字"}else{if(a.length<30){return"##不能少于30个汉字"}else{return true}}},wappdes:function(a,b){a=$.trim(a);b.val(a);if(a.length<30){return"##不能少于30个汉字"}else{return true}},installSize:function(a,b){a=$.trim(a);b.val(a);if(new RegExp(/^[\d]+\.?[\d]*([Mm][Bb]?)?$/).test(a)){return true}else{return"##格式不正确"}}};$('<div class="tooltip" id="tooltip"><div class="toolangle"><span class="a1">◆</span><span class="a2">◆</span></div><div class="tooltext"></div></div>').appendTo($("body"));window.tooltip={timer:null,show:function(d,b,a){var c=b.offset();$("#tooltip").show().css({left:c.left,top:c.top+b.height()}).find(".tooltext").html(d);clearTimeout(tooltip.timer);if(a){tooltip.timer=setTimeout(function(){$("#tooltip").fadeOut()},a)}}};OPEN_VALIDATOR.apptypeName=/iweibo/.test(location.pathname)?"组件":(/platform/.test(location.pathname)?"平台":"应用");$("form input[type='text'],form textarea").blur(function(){var b,a,c,e,d;b=$(this);a=b.val();c=b.attr("data-rule");e=b.attr("data-error");if((/^link|applink$/.test(c))&&a.length>0&&a.search(/http[s]?:\/\//)==-1){a="http://"+a;b.val(a)}if(OPEN_VALIDATOR.hasOwnProperty(c)&&c){if((!$.trim(a)&&c!="tname"&&c!="applink"&&c!="androidlink")||(a=="请选择"&&c=="appsupport")){e+="不能为空";d=false}else{var f=OPEN_VALIDATOR[c](a,b);if(f&&c=="appsupport"){d=OPEN_VALIDATOR.appsupportIsEmpty($(this));e+="不能为空"}else{if(f==undefined){d=false;e=""}else{if(f===true){d=true}else{if(f===1){return}else{d=false;e=f.replace(/##/g,e)}}}}}showmsg(d,b,e)}});var submitCallback=function(c){var b=+(c.ret||c.error),d=common.getMsgByRet(b);loginWin.close();if(d){loginWin.alert("<center>"+d+"</center>");return}if(b==0){if(loginWin){$(".app_check").html('<div class="app_check"><label>确认开发者信息</label><i class="active"></i><label>确认'+OPEN_VALIDATOR.apptypeName+'信息</label><i class="active"></i><label>确认'+OPEN_VALIDATOR.apptypeName+'素材</label><i class="active"></i><strong>提交审核</strong></div>');loginWin.alert({title:"提交审核",width:410,height:185,text:'<center><label class="icon_ok"></label> &nbsp; '+OPEN_VALIDATOR.apptypeName+"提交审核成功，审核人员会在两个工作日处理完毕。</center>"},function(){window.location.href=nextURL})}}else{var a="";if(b>100&&b<200){a="图片不合法"}else{if(b>200&&b<300){a="参数非法"}else{a=c.msg||"未知原因"}}if(loginWin){loginWin.show({title:"提交审核",width:410,height:185,text:'<center><br/><label class="icon_alert"></label> &nbsp; '+OPEN_VALIDATOR.apptypeName+"提交审核因为&nbsp;<strong>"+a+'</strong>&nbsp;失败，请稍后再试。<br/><input type="button" class="devSubmit closeBtn" value="确定"/></center>'});loginWin.contentarea.find(".closeBtn").bind("click",function(){loginWin.close()})}}};var submitMaterialCallBack=function(c){var b=+(c.ret||c.error),d=common.getMsgByRet(b),a='<div style="text-align:center;margin:30px 0 10px;">'+d+'</div><div style="text-align:center;"><a href="javascript:;" class="devSubmit closeBtn">确定</a></div>';loginWin.close();if(d){loginWin.show({title:"提示",width:410,height:185,text:a});loginWin.contentarea.find(".closeBtn").bind("click",function(){common.showLoginWin()});return}};function showmsg(c,d,a){var b;if(!c){b=' <span class="tip tip_err"><span class="tip_icon"></span>'+a+"</span>"}else{if(true===c){b=' <span class="tip tip_ok"><span class="tip_icon"></span></span>'}else{if(1===c){b=' <span class="tip tip_waiting"><span class="tip_icon"></span>'+a+"</span>"}else{if(2===c){b=' <span class="tip">'+a+"</span>"}}}}if(d.parent(".form_input").size()){d.parent(".form_input").parent().find(".tip").remove();d.parent(".form_input").after(b);d.parent(".form_input").parent().find(".inputdes").first().hide()}else{if(d.parent(".form_element").size()){d.parent(".form_element").parent().find(".tip").remove();d.parent(".form_element").after(b);d.parent(".form_element").parent().find(".inputdes").first().hide()}else{d.parent().find(".tip").remove();d.parent().append(b)}}}$(function(){$('<div class="tooltip" id="tooltip"><div class="toolangle"><span class="a1">◆</span><span class="a2">◆</span></div><div class="tooltext"></div></div>').appendTo($("body"));var a={timer:null,show:function(d,b,e){var c=b.offset();$("#tooltip").show().css({left:c.left,top:c.top+b.height()}).find(".tooltext").html(d);b.get(0).scrollIntoView(true);clearTimeout(a.timer);if(e){a.timer=setTimeout(function(){$("#tooltip").fadeOut()},e)}}};$("input[type='file']").change(function(){var k=this.files&&this.files[0],e=$(this),b=$(this).parent().find("img")[0],d=$(this).parent().find("img"),l=new Image(),g="",h=e.attr("_size")||500,f=e.hasClass("png_jpg")?2:1,o=f==2?new RegExp(/\.(png|jpeg|jpg)$/i):new RegExp(/\.(png)$/i),c=f==2?new RegExp(/^image\/(png|jpeg)$/i):new RegExp(/^image\/(png)$/i),n=f==2?"jpg/png":"png",q=function(){setTimeout(function(){d.removeAttr("src").attr("src","http://mat1.gtimg.com/app/opent/images/websites/0.gif");e.val("")},100)},i=function(r){loginWin.alert({text:'<div style="margin:0 0 0 30px;">由于您的浏览器安全限制，'+r+'<br/>请将本站( <span style="color:red;font-weight:bold;">'+location.href.slice(0,location.href.indexOf(location.pathname)+1)+'</span> )添加到受信任的站点列表中 <br/>点击此处了解 <a href="http://open.t.qq.com/bbs/forum.php?mod=viewthread&tid=21271" target="_blank">如何将本站添加到受信任的站点列表中？</a></div><div style="color:#090;margin:0 30px;">您也可以使用非IE内核浏览器，如chrome、firefox（Safari暂不支持）</div>',width:460,height:200});q()},p=function(){b.src="http://mat1.gtimg.com/app/opent/images/websites/0.gif";var r=setTimeout(function(){if(+(l.width||"")===0||+(l.height||"")===0){i("无法获取图片大小");e.attr("data-error",g);return}},200);l.onload=function(){if(this.complete){return false}if(o.test(l.src)==false){g="你上传的图片不是有效的"+n+"格式图片";loginWin.alert("<center>"+g+"</center>");e.attr("data-error",g);q();return}else{if(l.fileSize/1024>h){g="文件大小不能超过"+h+"K，请重新选择";loginWin.alert("<center>"+g+"</center>");e.attr("data-error",g);q();return}else{if(d.attr("_width")&&d.attr("_width")){if(+(l.width||"")===0||+(l.height||"")===0){i("无法获取图片大小");e.attr("data-error",g);q();return}else{if(l.width!=d.attr("_width")||l.height!=d.attr("_height")){g="你上传的图片尺寸"+l.width+"×"+l.height+"不符合要求，请选择一张"+d.attr("_width")+"×"+d.attr("_height")+"大小的"+n+"图片";e.attr("data-error",g);g+='<div style="border-top:1px dashed #ccc;margin-top:5px;padding-top:5px;"><strong>如果你的图片尺寸符合要求但仍然看到该提示，你可以：</strong><br/>1、如果你的浏览器是双核浏览器，可以切换到极速模式重新上传<br/>2、如果你的浏览器不是双核浏览器，可以使用其它浏览器，如chrome或firefox</div>';loginWin.alert({text:'<div style="margin:0 25px;">'+g+"</center>",width:500,height:215});e.attr("data-error",g);q();return}}}}}b.src=l.src;e.removeAttr("data-error");this.onload=null};l.onerror=function(){g="读取图片失败，浏览器不支持直接读取图片";i("加载图片失败");e.attr("data-error",g);l.onerror=null;q();return};l.src=e[0].value;return},j=function(){g="你的浏览器不支持fileReader，无法预览图片<br/>建议使用firefox或chrome浏览器或升级您当前的浏览器至最新版本";loginWin.alert({text:"<center>"+g+"</center>",height:170});e.attr("data-error",g);q();return},m=function(){var s=new FileReader(),r=function(u){return function(v){for(var w in u){u[w].src=v.target.result}}},t=false;s.onload=r([b,l]);s.readAsDataURL(k);r([b]);if(d.attr("_width")&&d.attr("_width")){(function(){var u=arguments.callee,v=arguments[0];if((((l.width||l.height)|0)==0)&&(v<10)){setTimeout(function(){u(++v)},100);return}if((l.width!=d.attr("_width")||l.height!=d.attr("_height"))&&!t){g="你上传的图片尺寸"+l.width+"×"+l.height+"不符合要求<br/>请选择一张"+d.attr("_width")+"×"+d.attr("_height")+"大小的"+n+"图片";b.src="http://mat1.gtimg.com/app/opent/images/websites/0.gif";loginWin.alert({text:"<center>"+g+"</center>",height:160});e.attr("data-error",g);q();return}e.removeAttr("data-error")})(0)}if(c.test(k.type)&&(k.fileSize||k.size)/1024<=h){}else{if(c.test(k.type)==false){g="你上传的图片不是有效的"+n+"格式图片";t=true;loginWin.alert("<center>"+g+"</center>");e.attr("data-error",g);q();return false}else{if((k.fileSize||k.size)/1024>h){g="文件大小不能超过"+h+"K，请重新选择";t=true;loginWin.alert("<center>"+g+"</center>");e.attr("data-error",g);q();return false}else{e.removeAttr("data-error");return true}}}};if(window.FileReader){return m()}else{if(document.all){return p()}else{return j()}}});$("input#devSubmit").click(function(){if(global_obj.data.app.app_type!==6){var q=true,k="";$("input[type='file']").each(function(){var r=$(this).parent().find("img");if((!$(this).val()&&!$(this).attr("data-default").replace("NULL",""))||$(this).attr("data-error")){q=false;k="<center>请选择一张"+r.attr("_width")+"×"+r.attr("_height")+"的png图片</center>";$(this).prev(".uploadbtn")[0].scrollIntoView(true);loginWin.alert(k);a.show(k,$(this).prev(".uploadbtn"),2000);return false}});if(!q){return false}}else{var j=this.form,h=$(j).find("input[data-working]");if(h.size()>0){h.attr("data-working",2);return false}var i=$.trim($(this).attr("data-rule")),g=+$("#app_platform").val();if(i=="formauto"){if($(j).hasClass("wirelessappform")&&g===0){loginWin.alert("<center>请至少选择一个平台</center>");return false}var b=this.form,o,f,c,l,p=true,n="",q=true;$("form input[type='text'],form input[type='hidden'],form textarea,select#app_class_main,select#app_class_child,form input[type='file'][data-default]^=''").each(function(){if($(j).hasClass("wirelessappform")){if(g===1){if($.contains($("#androidContainer")[0],$(this)[0])){return}}if(g===2){if($.contains($("#iphoneContainer")[0],$(this)[0])){return}}}c=$(this).attr("data-rule"),l=$(this).val(),f=$(this).attr("data-error");if(OPEN_VALIDATOR.hasOwnProperty(c)&&c){if((!$.trim(l)&&c!="tname"&&c!="applink"&&c!="androidlink")||(l=="请选择"&&c=="appsupport")){f+="不能为空";o=false}else{var r=OPEN_VALIDATOR[c](l,$(this));if(r&&c=="appsupport"){o=OPEN_VALIDATOR.appsupportIsEmpty($(this));f+="不能为空"}else{if(r===true){o=true}else{if(r===1){return}else{o=false;f=r.replace(/##/g,f)}}}}showmsg(o,$(this),f);if(p&&!o){loginWin.alert("<center>"+f+"</center>")}p=p&&o}else{if($(j).hasClass("wirelessappform")&&$(this).hasClass("required")){if((!$(this).val()&&!$(this).attr("data-default").replace("NULL",""))||$(this).attr("data-error")){q=false;k="<center>请上传"+$(this).attr("data-label")+"</center>";$(this).prev(".uploadbtn")[0].scrollIntoView(true);if(p){loginWin.alert(k)}a.show(k,$(this).prev(".uploadbtn"),2000);p=p&&q;return false}}}});if(!p){return p}if($(j).hasClass("wirelessappform")){var m=$("input[name='appplatform']");if($("input[name='appplatform']:checked").length==0){showmsg(false,$("#iphone_pf"),"请至少选择一个平台");loginWin.alert("<center>请至少选择一个平台</center>");return false}}}}var e=$("input[name='user_agree']");if(e.size()===0){if(p){$("form").submit()}else{return false}}else{if(e.not(":checked").size()>0){loginWin.alert("<center>您尚未同意《"+(e.not(":checked").attr("agreement")||"腾讯微博开放平台开发者服务协议")+"》</center>");return false}else{$("form").submit();return false}}var d=confirm("审核结果返回前，将不能修改"+OPEN_VALIDATOR.apptypeName+"信息，确定将此"+OPEN_VALIDATOR.apptypeName+"提交审核？");if(!d){return d}loginWin.show({title:"提交审核",width:410,height:120,text:"<div style='text-align:center;line-height:59px;'>数据提交中，请勿操作或关闭浏览器窗口</div>"});return true})});